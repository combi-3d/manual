
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Manual of CoMBI">
      
      
        <meta name="author" content="Tajika Y.">
      
      
      <link rel="icon" href="../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Overview of Image Processing/画像処理の概要 - Manual of CoMBI</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview-of-image-processing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Manual of CoMBI" class="md-header__button md-logo" aria-label="Manual of CoMBI" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Manual of CoMBI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Overview of Image Processing/画像処理の概要
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Manual of CoMBI" class="md-nav__button md-logo" aria-label="Manual of CoMBI" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    Manual of CoMBI
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        Top page
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Installation/導入
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation/導入" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Installation/導入
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/system/index.html" class="md-nav__link">
        System Overview/概要
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/camera/index.html" class="md-nav__link">
        Imaging devices/カメラなど
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/selfmade/index.html" class="md-nav__link">
        Self-made devices/自作装置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/computer/index.html" class="md-nav__link">
        Computer and storage/コンピュータとストレージ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/application/index.html" class="md-nav__link">
        Applications/アプリケーション
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Instruction/操作
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Instruction/操作" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Instruction/操作
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/frozenblock/index.html" class="md-nav__link">
        Frozen Block
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/paraffinblock/index.html" class="md-nav__link">
        Paraffin Block
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/camerasettings/index.html" class="md-nav__link">
        Camera Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/tethering/index.html" class="md-nav__link">
        Tethering (optional)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-u/index.html" class="md-nav__link">
        CoMBI-U (Universal)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-c/index.html" class="md-nav__link">
        CoMBI-C (Cryostat)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-s/index.html" class="md-nav__link">
        CoMBI-S (Sliding, motorized)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-s-m/index.html" class="md-nav__link">
        CoMBI-S (Sliding, manual)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-r/index.html" class="md-nav__link">
        CoMBI-R (Rotary, manual)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Image Processing/画像処理
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image Processing/画像処理" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Image Processing/画像処理
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Overview/概要
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rawjpeg/index.html" class="md-nav__link">
        RAW to JPEG conversion/RAW現像
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scale/index.html" class="md-nav__link">
        Resizing and Reducing/画像の縮小
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../registration/index.html" class="md-nav__link">
        Image Registration/ズレ補正
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../automation/index.html" class="md-nav__link">
        Automation/自動処理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../3dslicer/index.html" class="md-nav__link">
        3D Reconstruction, 3D slicer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../icy/index.html" class="md-nav__link">
        3D Reconstruction, Icy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../horos/index.html" class="md-nav__link">
        3D Reconstruction, Horos/OsiriX
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../correlation/index.html" class="md-nav__link">
        Correlation of 2D and 3D images/3D像に切片位置を示す
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../EDF/index.html" class="md-nav__link">
        Extended Depth of Field/深度合成
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ilastik/index.html" class="md-nav__link">
        Segmentation by ilastik/セグメンテーション
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/gallery/index.html" class="md-nav__link">
        Gallery/作品集
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../publication/publication/index.html" class="md-nav__link">
        Publications/論文
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" data-md-state="indeterminate" type="checkbox" id="__nav_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Electronics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Electronics" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Electronics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/ATmega328P/index.html" class="md-nav__link">
        ATmega328P standalone/単体利用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/terminal/index.html" class="md-nav__link">
        Crimped terminal/圧着端子
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/vender/index.html" class="md-nav__link">
        Venders/パーツの入手先
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/mkdocs/index.html" class="md-nav__link">
        Mkdocs-material/HPづくり
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/camera_terminal/index.html" class="md-nav__link">
        Camera terminal/カメラ端子
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="overview-of-image-processing">Overview of Image Processing/画像処理の概要</h1>
<p><img alt="Automation" src="../img/macro_illust_current.png" title="Overview of image processing" /><br>
<em>Overview of image processing</em></p>
<p>This page lists the image processing steps and the files generated at each step.</p>
<p><span style="color:#444C99;">画像処理とそれで生成されるファイルを列記します。</span></p>
<ol>
<li>
<p>Imaging/撮影</p>
<p>Serial images in RAW, original data, 12 bit or 16 bit, regulary 10 to 50 GB, so heavy !</p>
<p><span style="color:#444C99;">RAW形式の連続画像、元データ、12bitや16bit、10-50ギガバイト、重い。</span></p>
</li>
<li>
<p>RAW-JPEG conversion/変換</p>
<p>Serial images in JPEG, 8 bit color, less than 1 GB but still heavy for processing. The conversion app can process serial images identically and sequentially.</p>
<p><span style="color:#444C99;">JPEG形式の連続画像、8bit カラー、保存容量は1GB程度に収まる。しかし処理する際は、非圧縮相当の容量として扱われるので、まだまだ重くて扱いづらい。RAW現像アプリで、連続画像の同一調整、一括変換が可能です。</span></p>
</li>
<li>
<p>Resize/縮小</p>
<p>Resized serial images in JPEG, 8 bit color or grayscale. Make pixel size 5, 10, 20, 40 etc µm/pixel, images size between 500x500 to 1000x1000. Lighten the data size for image registration (next step). Automatic execution is possible by ImageJ macro.</p>
<p><span style="color:#444C99;">縮小したJPEG連続画像、カラーでもグレーでも、ズレ補正のために、軽くする、ついでにキリの良いピクセルサイズで扱いやすい。たとえば5, 10, 20, 40 µm/pixelの連続画像をつくっておく。小さいほうの連続画像が500x500 ~ 1000x1000 pixelsになるまで、縮小する。自動処理が可能でImageJ macroを使います。</span></p>
</li>
<li>
<p>Image registration/ズレ補正</p>
<p>This step creates registrated serial images in JPEG, and a Log file recording distance value used for registration. In CoMBI-C, R (cryostat, or rotating type), a moving block is imaged, so there may be vertical misalignment between images. For CoMBI-S (sliding type), this step is not required. The block circumference is used as the reference for registration. Registration is done using a light image series (roughly 500x500 to 1000x1000). The amount of data that can be handled depends on the installed memory size. In my experience, registration is often done using serial images with a pixel size of 40 µm/pixel or 20 µm/pixel. When applying registration to a high-resolution image, first registrate a small serial image, and then apply the registration to the a large (high-resolution) serial image using a Log file. Semi-automatic excecution is possible by ImageJ macro and Excel VBA.</p>
<p><span style="color:#444C99;">ズレ補正されたJPEG連続画像、Logファイル（ズレ補正での移動距離の記録）が生成されます。CoMBI_クリオスタットなど回転式ミクロトームでは、動いているブロックを撮影するので、画像間で上下にズレていることがあり、これを補正します。CoMBI_滑走式ミクロトームでは、このステップは不要です。補正の基準として、ブロック外周を利用します。軽い画像シリーズ（おおよそ500x500〜1000x1000、最大枚数はおおよそ2000枚まで）で行う。扱えるデータ量は、搭載メモリに依存する。経験上、ピクセルサイズを40 µm/pixelや20 µm/pixelにした連続画像で行うことが多い。高精細画像に補正をかけるときは、いったん軽い画像でズレ補正し、その補正時の移動値（Logファイル）を利用して高精細画像に補正を適用できる。自動処理が可能で、ImageJ macroとExcel VBAを使います。</span></p>
</li>
<li>
<p>Crop/切り抜き</p>
<p>Croped serial images in JPEG. color and grayscale. The above registration process required the block periphery, but it can/should be removed to lighten the data for the 3D reconstruction.</p>
<p><span style="color:#444C99;">必要なところ（試料）だけを切り抜いた連続画像（カラー、グレースケール、ピクセルサイズ各種）。上記のズレ補正ではブロック外周が必要でしたが、ズレ補正に成功すれば、次の3Dイメージングのために、外周の領域は除去して、データを軽くします。自動処理が可能で、ImageJ macroを使います。</span></p>
</li>
<li>
<p>3D reconstruction/3D再構築</p>
<p>JPEG serial images (color, gray, and registrated) can be loaded into a 3D application; 3D slicer saves the serial images and various operation records as a single data set; Horos converts the data to DICOM and stores it in the "Horos Database" folder.</p>
<p>Grayscale sequential images can be used for MPR and VR, while color sequential images can only be used for MPR. Still images and movies can be exported from each 3D reconstructed image. </p>
<p>In 3D slicer, you can choose saving formats among two type; the image data and segmentation data as separate files, or as an integrated project file. I prefer to use 3D slicer for segmentation and save as an integrated file. In OsiriX/Horos, segmentation data will be saved as separate files. When doing segmentation in Horos/OsiriX, the number of files to be saved increases. For example, when I marked 9 lymph nodes, I had to save 9 files. Managing them bothered me.</p>
<p><span style="color:#444C99;">JPEG連続画像（カラー、グレー、ズレ補正済み）を3Dアプリに読み込ませる。3D slicerなら、連続画像と各種操作記録を一体化したデータで保存する。Horosなら、DICOMに変換されて、"Horos Database"フォルダに、蓄積される。</span></p>
<p><span style="color:#444C99;">グレースケール連続画像はMPR, VRに利用し、カラー連続画像はMPRのみで利用できます。それぞれの3D再構築像から、静止画や動画を書き出せます。</span></p>
<p><span style="color:#444C99;">セグメンテーションとは、マークした領域だけを3D画像にすること。3D slicerでは、保存形式は二通りから選べます。画像データやセグメンテーションデータを個別ファイルとして保存するやり方と、それらをプロジェクトとして一体ファイルとして保存するやり方、です。一体型は重くなりますが、ファイル管理の面倒がなくなるので、気に入っています。Horos/OsiriXでセグメンテーションをやると、保存すべきファイルが増えていきます。例えば、「リンパ節を9個、マークできた」となると、9個のファイルができます。ちゃんと管理すればいいですが、どれがどれだか、ネーミングに困ります。</span></p>
</li>
</ol>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © 2021 Yuki Tajika, CC BY 4.0
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a6c66575.min.js"></script>
      
    
  </body>
</html>