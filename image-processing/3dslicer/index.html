
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Manual of CoMBI">
      
      
        <meta name="author" content="Tajika Y.">
      
      
      <link rel="icon" href="../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.9">
    
    
      
        <title>3D slicer （Win, Mac, Linux） - Manual of CoMBI</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.120efc48.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#3d-slicer-win-mac-linux" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Manual of CoMBI" class="md-header__button md-logo" aria-label="Manual of CoMBI" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Manual of CoMBI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3D slicer （Win, Mac, Linux）
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Manual of CoMBI" class="md-nav__button md-logo" aria-label="Manual of CoMBI" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    Manual of CoMBI
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        Top page
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Installation/導入
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation/導入" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Installation/導入
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/system/index.html" class="md-nav__link">
        System Overview/概要
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/camera/index.html" class="md-nav__link">
        Imaging devices/カメラなど
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/selfmade/index.html" class="md-nav__link">
        Self-made devices/自作装置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/computer/index.html" class="md-nav__link">
        Computer and storage/コンピュータとストレージ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/application/index.html" class="md-nav__link">
        Applications/アプリケーション
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Instruction/操作
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Instruction/操作" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Instruction/操作
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/frozenblock/index.html" class="md-nav__link">
        Frozen Block
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/paraffinblock/index.html" class="md-nav__link">
        Paraffin Block
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/camerasettings/index.html" class="md-nav__link">
        Camera Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/tethering/index.html" class="md-nav__link">
        Tethering (optional)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-u/index.html" class="md-nav__link">
        CoMBI-U (Universal)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-c/index.html" class="md-nav__link">
        CoMBI-C (Cryostat)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-s/index.html" class="md-nav__link">
        CoMBI-S (Sliding, motorized)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-s-m/index.html" class="md-nav__link">
        CoMBI-S (Sliding, manual)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-r/index.html" class="md-nav__link">
        CoMBI-R (Rotary, manual)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Image Processing/画像処理
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image Processing/画像処理" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Image Processing/画像処理
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/index.html" class="md-nav__link">
        Overview/概要
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rawjpeg/index.html" class="md-nav__link">
        RAW to JPEG conversion/RAW現像
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scale/index.html" class="md-nav__link">
        Resizing and Reducing/画像の縮小
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../registration/index.html" class="md-nav__link">
        Image Registration/ズレ補正
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../automation/index.html" class="md-nav__link">
        Automation/自動処理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        3D Reconstruction, 3D slicer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../icy/index.html" class="md-nav__link">
        3D Reconstruction, Icy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../horos/index.html" class="md-nav__link">
        3D Reconstruction, Horos/OsiriX
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../correlation/index.html" class="md-nav__link">
        Correlation of 2D and 3D images/3D像に切片位置を示す
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../EDF/index.html" class="md-nav__link">
        Extended Depth of Field/深度合成
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ilastik/index.html" class="md-nav__link">
        Segmentation by ilastik/セグメンテーション
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/gallery/index.html" class="md-nav__link">
        Gallery/作品集
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../publication/publication/index.html" class="md-nav__link">
        Publications/論文
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" data-md-state="indeterminate" type="checkbox" id="__nav_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Electronics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Electronics" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Electronics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/ATmega328P/index.html" class="md-nav__link">
        ATmega328P standalone/単体利用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/terminal/index.html" class="md-nav__link">
        Crimped terminal/圧着端子
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/vender/index.html" class="md-nav__link">
        Venders/パーツの入手先
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/mkdocs/index.html" class="md-nav__link">
        Mkdocs-material/HPづくり
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/camera_terminal/index.html" class="md-nav__link">
        Camera terminal/カメラ端子
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/Rstudio/index.html" class="md-nav__link">
        Rstudio/練習中
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#things-to-do" class="md-nav__link">
    Things to do/できること
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-installation" class="md-nav__link">
    1. Installation/インストール
  </a>
  
    <nav class="md-nav" aria-label="1. Installation/インストール">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    Windows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#macos" class="md-nav__link">
    MacOS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-basic-operation" class="md-nav__link">
    2. Basic operation/基本操作
  </a>
  
    <nav class="md-nav" aria-label="2. Basic operation/基本操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module" class="md-nav__link">
    Module/モジュール
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-dicom-data" class="md-nav__link">
    Load DICOM data/データ読込
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-windows" class="md-nav__link">
    View windows/画面表示
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#browse-slices" class="md-nav__link">
    Browse slices/スライス閲覧
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zoom-in-and-out" class="md-nav__link">
    Zoom in and out/拡大と縮小
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#move" class="md-nav__link">
    Move/移動
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#brightness-and-contrastct" class="md-nav__link">
    Brightness and contrast/CT値の調節
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blue-window-3d-view" class="md-nav__link">
    Blue window; 3D view/青画面
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#screenshot" class="md-nav__link">
    Screenshot/スクリーンショット
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#close" class="md-nav__link">
    Close／閉じる
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-advanced-operationcombi" class="md-nav__link">
    3. Advanced operation/CoMBIの連続画像
  </a>
  
    <nav class="md-nav" aria-label="3. Advanced operation/CoMBIの連続画像">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit" class="md-nav__link">
    Unit/単位
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-file-formatjpeg" class="md-nav__link">
    Image file format/連続画像はJPEG
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-name-batch-conversion" class="md-nav__link">
    File name Batch conversion/ファイル名一括変換
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-serial-images" class="md-nav__link">
    Load serial images/連続画像の読み込み
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-serial-images" class="md-nav__link">
    Setting up serial images/連続画像の設定
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-rendering" class="md-nav__link">
    Volume Rendering
  </a>
  
    <nav class="md-nav" aria-label="Volume Rendering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#essentials" class="md-nav__link">
    Essentials/準備とツール
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coloring" class="md-nav__link">
    Coloring/色付け
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tips" class="md-nav__link">
    Tips
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#keep-scenes" class="md-nav__link">
    Keep scenes/表示位置を記録
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movie-creation-by-os" class="md-nav__link">
    Movie creation by OS/簡易的な動画制作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#movie-creation-by-3d-slicer2016" class="md-nav__link">
    Movie creation by 3D slicer/アプリ機能(2016年実装)で動画制作
  </a>
  
    <nav class="md-nav" aria-label="Movie creation by 3D slicer/アプリ機能(2016年実装)で動画制作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-ffmpegffmpeg" class="md-nav__link">
    Install ffmpeg/事前準備、ffmpegのインストール
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-1-recording-operations" class="md-nav__link">
    Step 1: Recording operations/操作を記録
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-movie-export" class="md-nav__link">
    Step 2: Movie export/動画を書き出す
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tips_1" class="md-nav__link">
    Tips/ヒント
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-data" class="md-nav__link">
    Save data/保存
  </a>
  
    <nav class="md-nav" aria-label="Save data/保存">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#save-everything-as-a-single-file" class="md-nav__link">
    Save everything as a single file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-each-processed-data-into-individual-files" class="md-nav__link">
    Save each processed data into individual files.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    画像データも作業内容もひとつのファイルに保存する（公式サイトでは推奨）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    作業内容を個別に保存する（なにかとメリットはある）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#segmentaion" class="md-nav__link">
    Segmentaion/セグメンテーション
  </a>
  
    <nav class="md-nav" aria-label="Segmentaion/セグメンテーション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#procedure-of-manual-segmentation-by-3dslicersegmentation" class="md-nav__link">
    Procedure of manual segmentation by 3Dslicer/手作業でSegmentationする手順
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obtaining-volume-values-of-segments" class="md-nav__link">
    Obtaining volume values of segments/セグメントの体積を数値として取得する
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tips_2" class="md-nav__link">
    Tips/工夫やヒント
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3d-printer3d-in-practicing" class="md-nav__link">
    3D printer/3Dプリンタ (in practicing)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="3d-slicer-win-mac-linux">3D slicer （Win, Mac, Linux）</h1>
<h2 id="things-to-do">Things to do/できること</h2>
<ol>
<li>Installation/インストール</li>
<li>DICOM, Basic operation/<span style="color:#444C99;">DICOM画像で基本操作に慣れる</span><br>
    Import DICOM data/<span style="color:#444C99;">データ読込</span><br>
    Display/<span style="color:#444C99;">画面表示　B、R、G、Y　青、赤、緑、黄</span><br>
    View DICOM slice/<span style="color:#444C99;">スライス閲覧</span><br>
    Zoom in and out/<span style="color:#444C99;">拡大縮小</span><br>
    Move/<span style="color:#444C99;">移動</span><br>
    Hansfield value/<span style="color:#444C99;">CT値の調節</span><br>
    3D View/<span style="color:#444C99;">青画面</span><br>
    Screen shot/<span style="color:#444C99;">スクリーンショット</span><br></li>
<li>CoMBI, Serial JPEG image/<span style="color:#444C99;">いざCoMBI</span><br>
    Unit/<span style="color:#444C99;">単位設定</span><br>
    Serial JPEG image/<span style="color:#444C99;">連続JPEG画像の準備</span><br>
    Manage serial file name/<span style="color:#444C99;">ファイル名一括変換、必要に応じて</span><br>
    Load serial image/<span style="color:#444C99;">連続画像の読み込み</span><br>
    Settings for serial image/<span style="color:#444C99;">連続画像の設定</span><br>
    Volume Rendering/<span style="color:#444C99;">ボリュームレンダリング</span><br>
    Movie/<span style="color:#444C99;">動画</span><br>
    Save/<span style="color:#444C99;">保存</span><br>
    Segmentation/<span style="color:#444C99;">セグメンテーション、体積</span><br>
    3D printer/<span style="color:#444C99;">3Dプリンタ</span><br></li>
</ol>
<p>3D slicer is free and open source software. It has been developed by Brigham and Women's Hospital (Harvard-affiliated hospital) since 2002, and updates and extensions (Extensions = plug-ins) continue to be released. It supports various operating systems including Windows, Mac, and Linux, so it is recommended for CoMBI users. At the beginning of CoMBI development in 2014, I tested 3D viewers that could handle JPEG serial images and selected OsiriX. However, OsiriX became a paid app, and Horos, which is the open source version of OsiriX, remained unstable, and OsiriX/Horos only supports MacOS, which was not the best situation for CoMBI to be popular.<br>
3D slicer has been confirmed to work stably on laptops. It worked on typical laptops for students (2018, i5-8250U 1.6-1.8GHz, 8GB RAM, and i5-7300U 2.6-2.7GHz, 8GB RAM, both with integrated graphics, Windows 10). The size of the application is 1.2 GB for 3D slicer compared to 150 MB for Horos. (If students have limited disk space as their student life progresses, make sure to free some space before installing!) The environment used in this document is 3D slicer v4.11 (2020.9.30), macOS 10.15.7 iMac 2017 (4.2GHz 4-Core Intel Core i7, ,64GB 2400 MHz DDR4, RadeonPro 580 8GB). MacBookPro15 2018 (2.9GHz 6-Core Intel Core i9, 32GB 2400MHz DDR4, RadeonPro Vega20 4GB), MacBookPro16 (2021, M1 max, 64GB unified). Official recommendations are; 4GB memory at minimum, 8GB recommended, dGPU, VRAM 2x larger than data volume, multi core CPU. <br>
Official documentation can be found on the 3D slicer homepage. Also, many instruction videos can be found on the Internet. I am still practicing 3D slicer, especially "movie" and "segmentation". Please refer to the <a href=https://slicer.readthedocs.io/en/latest/>Official website</a> for detail.</p>
<p><span style="color:#444C99;">3D slicerは、無料のオープンソースソフトウェアです。米国ブリガム・アンド・ウィメンズ病院（ハーバード大学関連病院）が 2002年から開発していており、現在もアップデートや機能拡張（Extensions = plug-ins）が続けられています。対応OSは、Windows、Mac、Linuxと幅広いので、多様なCoMBIユーザにおすすめです。<br>
CoMBI開発当初の2014年、JPEG連続画像が扱える3Dビューワを検証し、多機能で動作が軽いOsiriXを選択しました。しかし、OsiriXはのちに有料になり、オープンソース版OsiriXの流れをくむHorosは不安定さが残り、OsiriX/HorosにはMacOSにしか対応しないなど、CoMBI普及の観点からはベストな状況ではありませんでした。かつては、OsiriXと3D slicerとの間に機能的な違いがありましたが、現在はどちらもできることは同じです。（かつては、動画描きだしが簡単にできるOrisiX、できない3D slicerでしたが、2016年の3D slicer v4.6以降は、動画書き出し機能が実装されています。）<br>
3D slicer はノートパソコンでも安定して動作するのを確認しています。大学入学時に購入する典型的なスペック（2018年製,i5-8250U 1.6-1.8GHz, RAM8GB、および、i5-7300U 2.6-2.7GHz, RAM8GB, 共に統合グラフィクス、Windows10）でも動作しました。アプリ本体の容量は、Horos 150MBに対して、3D slicerは1.2GBとなっています。（もし、学生生活が進むに連れ、ディスク残量が少なくなっている場合は、空き容量を確保の上、インストールしましょう。）<br>
本書での3D slicer利用環境は、3D slicer v4.11 (2020.9.30), macOS 10.15.7 iMac 2017 (4.2GHz 4-Core Intel Core i7, ,64GB 2400 MHz DDR4, RadeonPro 580 8GB). MacBookPro15 2018 (2.9GHz 6-Core Intel Core i9, 32GB 2400MHz DDR4, RadeonPro Vega20 4GB), MacBookPro16 (2021, M1 max, 64GB unified) です。3D slicer 公式の推奨環境は、「メモリ最低4GB 推奨8GB〜、単体GPU推奨、データ量より大きいVRAM、CPUマルチスレッド推奨」です。
公式Documentが3D slicerのホームページにあります。また解説動画もネットで多数見つかります。筆者は、3D slicerの練習中で、とくに「動画」「セグメンテーション」はあいまいさ、不完全さがのこります。くわしくはぜひ<a href=https://slicer.readthedocs.io/en/latest/>公式サイト、説明書</a>を参照してください。<br></span></p>
<hr />
<h2 id="1-installation">1. Installation/インストール</h2>
<ol>
<li>Visit official site/公式サイト　<a href=https://www.slicer.org/>https://www.slicer.org/</a></li>
<li>Go to <code>Download Slicer</code> and download app for each OS（Win、Mac、Linux）</li>
</ol>
<h3 id="windows">Windows</h3>
<ol>
<li>Open installer (.exe file). </li>
<li>For start app, go to <code>Windows Start</code>. </li>
<li>
<p>For uninstall app, use <code>Windows settings</code>, <code>Apps&amp;Features</code>.</p>
<p><span style="color:#444C99;">
<br>
インストーラ（.exeファイル）を起動する。注意：インストール先のアドレスは、英語のみで表記されていることが望ましい。日本語が入らないほうがよい。アプリの起動は、Windows Startメニューより。アンインストールは、Windows settingsの、Apps&amp;Featuresを使用する
</span></p>
</li>
</ol>
<h3 id="macos">MacOS</h3>
<ol>
<li>Open install package (.dmg file). </li>
<li>Permit installation at <code>System Preferences</code>&gt; <code>Security &amp; Privacy</code>&gt; <code>General</code>&gt; <code>Allow apps downloaded from:</code>.</li>
<li>Drag and drop <code>Slicer.app</code> into Application folder. </li>
<li>For start app, go to <code>Application</code>. </li>
<li>
<p>For uninstall app, just delete <code>Slicer.app</code>, or use <code>AppCleaner</code> (freeware). </p>
<p><span style="color:#444C99;">
<br>
インストールパッケージ（.dmgファイル）を起動する。「開発元が確認できません」というメッセージがでるので、環境設定からインストールを許可する。Slicer.appをApplicationフォルダへ移動（ドラッグ＆ドロップ）。アプリの起動は、Applicationフォルダより。アンインストールは、Slicer.appを削除するか、削除アプリを使用する。
</span></p>
<hr />
</li>
</ol>
<h2 id="2-basic-operation">2. Basic operation/基本操作</h2>
<p>You can practice basic operation with sample DICOM data that can be freely downloaded freely from 3D slicer data server. DICOM is a kind of file format that is used for medical images such as CT and MRI. </p>
<p><span style="color:#444C99;">
<br>
サンプルDICOMデータを使って、基本操作を練習できます。DICOMとはCTやMRIなどの医療画像に使われている画像形式です。
</span></p>
<h3 id="module">Module/モジュール</h3>
<p><strong>Modules</strong> are various "functions" of 3D slicer. In the initial window, you see <code>Modules</code>, and <code>Welcome to Slicer</code> by default. <code>Modules</code> will often appear in this document.</p>
<p><img alt="3D slicer open" src="../img/slicer01.png" title="open" /><br>
<em>Modules pull-down and Download sample data button</em></p>
<p><span style="color:#444C99;">
<strong>モジュール</strong>とは、各種機能のこと。起動すると、<code>Modules</code>&gt;<code>Welcome to Slicer</code>が表示される。あとにつづく説明で頻繁に出てくる用語
</span></p>
<h3 id="load-dicom-data">Load DICOM data/データ読込</h3>
<ul>
<li>DICOM sample data: Press button <code>Download Sample Data</code>. How about CTChest (40MB) for initial practice? </li>
<li>
<p>DICOM data of your own: Drag&amp;drop a folder including DICOM serial images from Finder (mac) to 3D slicer window (any place). </p>
<ul>
<li><code>Load directly into DICOM database</code> will create list of patients at local disc. After import, go to <code>Modules</code>&gt;<code>DICOM</code> and double click the patient name to open.</li>
<li><code>Any Data</code> is simple. I preferentially use this option for CoMBI to save disc space. </li>
</ul>
<p><span style="color:#444C99;">
<br>
公式のサンプルDICOMデータで練習をはじめられる。<code>Download Sample Data</code>ボタンより、まずはひとつ（例えば、CTChest約40MB）ダウンロードする。手持ちのDICOMデータがある場合、Finder（Mac）から、フォルダごと、ドラッグ&amp;ドロップする（ウィンドウ内のどこでもよい）。メッセージウィンドウSelect a readerでは、パソコン内に患者一覧データベースを作る場合<code>Load directly into DICOM database</code>を選んで<code>OK</code>。読み込み後、Module<code>DICOM</code>に切り替わって、患者一覧になり、患者名をダブルクリックすると、DICOMデータ表示画面へと進める。もしくは、とりあえずデータを見たい場合は、<code>Any Data</code>を選ぶ。CoMBIの実験データでは、Any Dataを使っている。
</span></p>
</li>
</ul>
<h3 id="view-windows">View windows/画面表示</h3>
<p>There are four different views, B, R, G, and Y (blue, red, green, and yellow). The red, green, and yellow views display the orthogonal planes (Multiple Planer Reconstruction, MPR). The blue screen "3D View" displays volume rendering (VR), etc. As a default, the four-plane display mode (Four-up) is selected and shows all 4 views at a time.</p>
<ul>
<li>
<p>To change the screen layout, choose from the <code>Layout</code> icons at the top or <code>Menu bar</code>&gt;<code>View</code>&gt;<code>Layout</code>. You can choose from various layouts such as 4-up or 1-up.</p>
<p><img alt="Layout button" src="../img/3dslicer_layout.jpg" title="Layout" /> </p>
<p><span style="color:#444C99;">
<br>
4種類の画面、B、R、G、Y（青、赤、緑、黄）がある。デフォルトでは、画面は4分割される4面表示モード（Four-up）が選ばれている。赤、緑、黄の画面には、直交面MPR（Multiple Planer Reconstruction）が表示される。青画面「3D View」には、Volume Rendering などが表示される。画面表示のレイアウトを変更するには、上部に並ぶアイコン<code>Layout</code>から選ぶ。または、Menu bar&gt; <code>View</code>&gt;<code>Layout</code>から選ぶ。4画面や1画面など多様なレイアウトから選べる。
</span></p>
</li>
</ul>
<h3 id="browse-slices">Browse slices/スライス閲覧</h3>
<p>Browsing slices means to flip through serial images.  In the case of DICOM images such as CT, a single image is called <strong>"a slice"</strong>, so the term <strong>"browse slices"</strong> is used in 3D slicer app and other DICOM viewer. There are 2-ways for browsing;</p>
<ul>
<li><code>Scroll mouse wheel</code> on the Red, Green, Yellow windows.</li>
<li>
<p><code>Scroll bar</code> on the top of each windows.</p>
<p><span style="color:#444C99;">
<br>
連続画像をパラパラとめくって観ることです。CTなどのDICOM画像の場合、一枚の画像をスライスと呼ぶことから、閲覧する行為にも、スライスという用語がでてくる。方法は2通り；赤、緑、黄、各画面上で<code>マウスホイール</code>を回す、もしくは、各画面の上端にある<code>スクロールバー</code>を使う。
</span></p>
</li>
</ul>
<h3 id="zoom-in-and-out">Zoom in and out/拡大と縮小</h3>
<ul>
<li><code>Drag up and down with right button of mouse</code> on the Red, Green, Yellow windows. </li>
<li>Input values. (Not usually use, but worthy for movie creation.)<ul>
<li>Expand menu by <code>Pin-like mark</code> on left top corner of each windows. </li>
<li>Go to <code>Extension mark</code>&gt;<code>Field of View</code>, and input value.通常は使わないが、動画準備のときに使えそう。</li>
</ul>
</li>
<li>
<p><code>Centering button</code> is available. The button is designed with squere and lines, and found between R、G、Y and scroll bar.  When you get lost, press it to return to the center position.</p>
<p><img alt="Adjust button" src="../img/3dslicer_scalling.jpg" title="adjust" /><br>
<em>Pin-like mark, Extension mark, Centering button, Field of View</em></p>
<p><span style="color:#444C99;">
<br>
基本的に、画面上で、<code>マウスの右ドラック</code>、各画面上で上下させることで、拡大縮小を行う。数値入力も可能で、押しピン様のマーク<code>Pin-like mark</code>でメニュー表示させ、拡張マーク<code>Extension mark</code>の<code>Field of View</code>で数値を入力する。通常は使わないが、動画準備のときに使えそう。中央にいっぱつで戻れるボタンがある。各画面のY、R、Gの右横の、中央配置ボタン<code>Centering button</code>。迷子になったときにこれを押すと便利。
</span></p>
</li>
</ul>
<h3 id="move">Move/移動</h3>
<p>Move image position up/down or right/left on R, G, Y window. </p>
<ul>
<li>Windows mouse: <code>Push center wheel</code>+<code>Drag</code></li>
<li>
<p>Mac Magic Mouse: <code>Keyboard shift key</code>+<code>Mouse left button</code>+<code>Drag</code></p>
<p><span style="color:#444C99;">
<br>
赤、緑、黄画面に表示されている画像を上下左右に移動させたいとき
</span></p>
</li>
</ul>
<h3 id="brightness-and-contrastct">Brightness and contrast/CT値の調節</h3>
<p>Bightness and contrast are called window level (L) and window width (W) in the case of CT images. For example, making brighter means increase window level (L), and increasing contrast means narrowing window width (W). There are 2-ways for adjusting;</p>
<ul>
<li>
<p>Mouse: Select an icon <code>Adjust</code>, and drag on the windows. Up/down change brightness, and right/left change contrast.</p>
<p><img alt="Adjust button" src="../img/3dslicer_adjust_button_mark.jpg" title="adjust" /></p>
</li>
<li>
<p>Input values: <code>Module</code>&gt;<code>Volumes</code>. Presets are convenient for CT slices, but not for CoMBI images. Pull-down menu contains <code>Auto W/L</code>, <code>Manual W/L</code>, and <code>Manual Min/Max</code>. <code>Manual W/L</code> allows to input values. <code>Scroll bar</code> is also available.</p>
<p><img alt="Module Volume Adjust" src="../img/3dslicer_volume_adjust_mark.jpg" title="adjust" /><br>
<em>Preset buttons (upper), Pull-down menu (middle), and scroll bar (bottom).</em></p>
<p><span style="color:#444C99;">
<br>
明るさとコントラストの調整を行う。CT画像の場合、明るさを明るく/暗くすることを、Window level（L）を上げる/下げると表現する。コントラストを上げる/下げることをWindow width（W）を小さく/大きくすると、表現する。方法は2つある。方法1、マウス：アイコン<code>Adjust</code>で、画像上でドラッグする。上下ドラッグと左右ドラッグで、明るさとコントラストを変える。方法2、数値入力： <code>Module</code> <code>Volumes</code>。（上）プリセットボタンが並ぶ、どれかが最適ならラク。（中）プルダウンメニューで、<code>Auto W/L</code>, <code>Manual W/L</code>, <code>Manual Min/Max</code>を選ぶ。<code>Manual W/L</code>では数値を入力できる。（下）<code>Scroll bar</code>でも調節できる
</span></p>
</li>
</ul>
<h3 id="blue-window-3d-view">Blue window; 3D view/青画面</h3>
<p>Blue window is called <strong>3D view</strong>, and used to display slices in 3D, volume rendered images and segmentations in 3D. </p>
<ol>
<li>
<p>Slice in 3D View </p>
<ul>
<li>Expand menu from <code>Pin-like mark</code>.</li>
<li>ON and OFF by pushing <code>Eye mark</code>.   </li>
</ul>
<p><img alt="Show slice" src="../img/3dslicer_show_slice.jpg" title="Show slice" /> </p>
</li>
<li>
<p>Volume Rendered image in 3D View (For detail, see later section <a href="/image-processing/3dslicer/index.html#volume-rendering">"Volume Rendering"</a>）</p>
<ul>
<li>Modules &gt; <code>Volume Rendering</code></li>
<li>ON and OFF: by pushing <code>Eye mark</code> on the left-side of <code>Volume</code>.</li>
<li>(<code>Preset</code> create colorful rendering, but default grayscale is enough for initial viewing.)</li>
<li>Adjust brightness: sliding <code>Shift</code> scroll bar.</li>
</ul>
<p><img alt="Show VR" src="../img/3dslicer_show_VR.jpg" title="Show VR" /> </p>
<ul>
<li>Change orientation: Set arrow icon <code>Select tool</code>, and drag VR image. </li>
<li><code>Centering button</code> at the left-top of the blue window reset the view at the center of specimen. Very useful when I get lost.</li>
</ul>
<p><img alt="VR basic" src="../img/3dslicer_blue_basic.jpg" title="VR basic" /> </p>
<ul>
<li>Zoom in and out: Mouse <code>Scroll</code> on the blue window.</li>
<li>Chanege color and transparancy: Advanced &gt; <code>Volume Properties</code></li>
<li>Smooth viewing: Display &gt; <code>Rendering</code> &gt; <code>GPU</code>. if you have dGPU</li>
<li>Smooth viewing: Display &gt; <code>Display ROI</code>. Restrict viewing area by handling <code>Dots in the image</code> or Advanced &gt; <code>ROI</code> &gt; <code>Scroll bar</code>.</li>
</ul>
</li>
<li>
<p>Segments in 3D View (For detail, see later section <a href="/image-processing/3dslicer/index.html#_17">"Segmentation"</a>)</p>
<ul>
<li>Modules &gt; <code>Segmentation Editor</code>. Button <code>Show 3D</code> switch ON and OFF.</li>
</ul>
<p><span style="color:#444C99;">
<br>
1. スライスを青画面に表示（画像一枚を青画面に表示）する：各画面の左上、押しピンマーク<code>Pin like mark</code>からメニューを表示。眼の印<code>Eye mark</code>で表示のON/OFF。
</span></p>
<p><span style="color:#444C99;">2. Volume Rendringの画像を表示する：モジュール<code>Volume Rendering</code>を選ぶ。眼の印<code>Eye mark</code>（<code>Volume</code>の左側）のON/OFFで、青画面でのVolume Rendering像を表示/非表示。調節に関して、下記に簡単に紹介する。詳しくは<a href="/image-processing/3dslicer/index.html#volume-rendering">後述「Volume Rendering」</a>。<br>
・<code>Shift</code>をスライドさせ、明暗を調節する。デフォルトはグレースケール。<code>Preset</code>にカラフルな表示設定がある<br>
・青画面左上のボタン<code>Centering</code>で、中央に表示させる。迷子になったときに便利です<br>
・ドラッグして、向きを変えられる。このとき、アイコン矢印のマーク<code>Select tool</code>にしておく<br>
・マウス<code>Scroll</code>を青画面上で上下させると、拡大縮小<br>
・Advanced<code>Volume Properties</code>で、 着色を調節したり、点を下げて透明度を調節したりする<br>
・Display<code>Rendering</code> で、dGPUがあるパソコンなら、<code>GPU</code>を選ぶと動作が軽快になる<br>
・Display<code>Display ROI</code>で、Volume Renderingする範囲を限定すると、動作が軽快になる。画像中の点<code>Dots in the image</code>を動かす、または、Advanced<code>ROI</code>の<code>Scroll bar</code>を動かす
</span></p>
<p><span style="color:#444C99;">3. セグメンテーションの結果を表示：モジュール<code>Segmentation Editor</code>を選ぶ。ボタン<code>Show 3D</code>で表示/非表示を切り替える。詳しくは<a href="/image-processing/3dslicer/index.html#_17">後述「Segmentation」</a></span></p>
</li>
</ol>
<h3 id="screenshot">Screenshot/スクリーンショット</h3>
<ol>
<li>
<p>Icon <code>Camera mark</code></p>
<p><img alt="Screen shot" src="../img/3dslicer_camera.jpg" title="Screen shot" /> </p>
</li>
<li>
<p>In the Setting window, select window to be captured.</p>
</li>
<li><code>Save as...</code>　Set file name and directory. Available image format is only PNG.</li>
<li>
<p><code>OK</code></p>
<p><span style="color:#444C99;">
<br>
アイコン、カメラマーク<code>Camera mark</code>を押すと、設定ウィンドウがでる。キャプチャーしたい画面を選び、<code>Save as...</code>。ファイル名と場所を指定する。形式はPNGのみ。<code>OK</code>をおして完了。
</span></p>
</li>
</ol>
<h3 id="close">Close／閉じる</h3>
<ol>
<li>Close app: <code>Slicer4.11</code>&gt; <code>Quit slicer</code>, or keyboard <code>command + Q</code>(Mac).</li>
<li>
<p>Close only data: <code>File</code>&gt; <code>Close scene</code>.</p>
<p><span style="color:#444C99;">
<br>
Closeアプリを閉じる場合は、<code>Slicer4.11</code>&gt; <code>Quit slicer</code>、またはショートカット<code>command + Q</code>(Mac)。データだけを閉じる場合は、<code>File</code>&gt; <code>Close scene</code>。
</span></p>
</li>
</ol>
<hr />
<h2 id="3-advanced-operationcombi">3. Advanced operation/CoMBIの連続画像</h2>
<h3 id="unit">Unit/単位</h3>
<p>Change unit from mm (default) to µm (suitable for CoMBI).</p>
<ol>
<li>Menu bar &gt; <code>Edit</code> &gt; <code>Application Settings</code> &gt; <code>Units</code></li>
<li>Check <code>Show advanced options</code></li>
<li>Length &gt; <code>Preset</code> &gt; <code>Select a preset</code> &gt; <code>Micrometer</code></li>
<li><code>OK</code></li>
<li>
<p>Restart 3D slicer app. Menu bar&gt; <code>Slicer 4.11</code>&gt; <code>Quit Slicer</code> and open app again. The unit should change to µm. If the unit remains mm, try after saving data. Open app, Change unit, load serial images, input value at Module&gt;Volume, and save.</p>
<p><span style="color:#444C99;">
<br>
CoMBIなら、µmを選びたい。上記の手順でやってみて、3D slicerを再起動させると、変更が反映されるはず。もし、再起動させたらmmにもどってしまう場合は、連続画像を用意して「アプリ起動 &gt; Unit選択 &gt; 連続画像読み込み &gt; モジュールVolumeで入力 &gt; Save」の順でやってみる。<br>
（2018-2021 memo：動作が重くなるかもしれないので、µmをmmのままで使うのがよい。単位を真面目に10µmなどにすると、アプリが落ちることがあった。画像は10µm/pixelだったとしても、10mm/pixelと入力する。デフォルトは1mmで、どうやらその付近なら安定していそう。パソコン環境やスペックが影響するかもしれない。XYZの比だけは正しくしておき、計測値が必要な場合は、あとで計算してから利用する。）（2022.3.11 memo：動作に変化はなかった。mm, µm, 比率をあわせた桁違い、いろいろな入力値を試して、セグメンテーションを実際に行った。MBP16。たんにスペックの問題だったか。かわりに、再起動でµmからmmに戻ってしまう症状をみつけた。）
</span></p>
</li>
</ol>
<h3 id="image-file-formatjpeg">Image file format/連続画像はJPEG</h3>
<p>In CoMBI, the original image (RAW format) is converted to JPEG format, and 3D analysis is performed using serial JPEG images. 3D slicer 4.11 supports a variety of image formats and can directly import serial JPEG images. However, it does not seem to support PNG format. When PNG images are loaded, they are viewed on the R, G, Y window, but not in the blue, 3D View. Only one PNG image are shown but not browsed. Transparency of PNG is not reflected and becomes solid white.</p>
<p><span style="color:#444C99;">
    <br>
    CoMBIでは、オリジナル画像（RAW形式）をJPEG形式へ変換し、連続JPEG画像として3D解析を行う。3D slicerは、様々な画像形式に対応しており、連続JPEG画像を直接とりこめる。ただし、PNG形式は非対応のようだ。PNGでは、読み込めて（Load）、赤、黄、緑画面での閲覧まではできる。しかし、3D View-青画面（Volume Rendering像など）への表示ができない（一枚だけで不変）。また、透明を設定したPNGでは、透明が反映されず白になる
    </span></p>
<h3 id="file-name-batch-conversion">File name Batch conversion/ファイル名一括変換</h3>
<p>File name batch conversion is done when there are special circumstances, such as filenames reverting from 9999 to 0001 at the middle of imaging. 3D slicer requires a complete sequential number (center column of the table). In case that the original filename is left behind the sequential number (right column of the table), 3D slicer will not recognize it as a serial image. When you change the numbering to complete sequential numbers, leave a note in the experiment notebook so that the original file names can be matched (so that the experiment can be reproduced). Just for information, Horos accepts both complete serial name (center column) and serial number plus original name (right column).</p>
<table>
<thead>
<tr>
<th>Original name</th>
<th>Compatible<br>for 3D slicer　</th>
<th>Uncompatible for 3Dslicer,<br>but compatible for Horos</th>
</tr>
</thead>
<tbody>
<tr>
<td>DSC_9997.jpg</td>
<td>0001.jpg</td>
<td>0001_DSC_9997.jpg</td>
</tr>
<tr>
<td>DSC_9998.jpg</td>
<td>0002.jpg</td>
<td>0002_DSC_9998.jpg</td>
</tr>
<tr>
<td>DSC_9999.jpg</td>
<td>0003.jpg</td>
<td>0003_DSC_9999.jpg</td>
</tr>
<tr>
<td>DSC_0001.jpg</td>
<td>0004.jpg</td>
<td>0004_DSC_0001.jpg</td>
</tr>
<tr>
<td>DSC_0002.jpg</td>
<td>0005.jpg</td>
<td>0005_DSC_0002.jpg</td>
</tr>
<tr>
<td>DSC_0003.jpg</td>
<td>0006.jpg</td>
<td>0006_DSC_0003.jpg</td>
</tr>
</tbody>
</table>
<ul>
<li>Windows OS: <code>Explore</code>, <code>Select multiple files</code>, <code>Rename</code>. "Input-char+(1).jpg" will be created. Original fileneme will be lost.</li>
<li>Mac OS: ：<code>Finder</code>, <code>Select multiple files</code>, <code>Right click, sub-menu</code>, <code>Rename</code>. For customize in some extent, use pull-down <code>Format</code>, and following pull-down <code>Name and Counter</code>.</li>
<li>
<p>Adobe Bridge (Paid app) can custamize file names in any style you like.</p>
<p><span style="color:#444C99;">
<br>
撮影中にファイル名が9999から0001に戻ったとか、特別な事情があるときに、ファイル名を一括で変換する。CoMBIの撮影が通常に成功した場合は、必要ない。3D slicerの場合、完全な連番（表の中央列）が必要である。連番のうしろに元ファイル名を残した場合（表の右列）、3D slicerは連続画像とは認識しない。完全な連番に変更しても、元々のファイル名と照合できるよう（実験が再現できるよう）、実験ノートにメモを残す。ちなみに、Horosの場合、頭に連番さえあればよく、元ファイル名も残したスタイルが使える。<br>
Windows OSやmacOSの組み込み機能で変換できる。Windowsの場合、<code>Explore</code>で、複数選択<code>Select multiple files</code>、名称変更<code>Rename</code>すると、「入力文字(1).jpg」と、カッコつき連番数字になる。元のファイル名は残らないので注意する。Macの場合、<code>Finder</code>で、複数選択<code>Select multiple files</code>、右クリック（副メニュー）<code>Right click, sub-menu</code>より、ファイル名を変更 <code>Rename</code>。完全変更や連番追記など、ある程度カスタマイズできる。プルダウンメニューの<code>Format</code>, 次のプルダウン、<code>Name and Counter</code>を使う。もし、Adobe Bridge（有料アプリ）があれば、細かく設定ができる。
</span></p>
</li>
</ul>
<h3 id="load-serial-images">Load serial images/連続画像の読み込み</h3>
<p>"Load" in 3D slicer is same as "open" or "import" in some other apps. 3D slicer can handle multiple sets of serial images simultaneously, similar to the fusion of PET-MRI in medical imaging. In the case of CoMBI, you can construct a volume rendering from a series of grayscale images and overlay a color cross-sectional image (MPR) on the volume rendering. Sets of images can be named differentially, to distinguish during later image process. The default name is the first image file name, but I have renamed them Gray for 3D, Color series, and so on.</p>
<ol>
<li>Drag and drop a folder containing serial images or a first image. </li>
<li>Message window <code>Select a reader</code> appears. Select <code>Any data</code>, then <code>OK</code>.</li>
<li>New window <code>Add data into the scene</code> appears. The app should recognize serial images automatically, but lets check <code>Show options</code>. Confirm that <code>Single file</code> is <strong>uncheck</strong>.</li>
<li>
<p>Name sets of serial images. In the window <code>Add data into the scene</code>, input names. Even after loading, the name can be changed at Module &gt; <code>Volumes</code>, <code>Active volume</code> &gt; pull-down <code>Rename current volume</code>. </p>
<p><span style="color:#444C99;">
<br>
3D slicerで連続画像を開くことをLoadと呼ぶ。3D slicerは、複数の連続画像セット同時に扱える。医療画像における、PET-MRIの重ね合わせ（fusion）のような扱い方である。CoMBIの場合、グレースケール連続画像から Volume Renderingを構築し、カラーの断面像 (MPR)を 3面重ねて表示させるといった使い方ができる。3D slicer内での各セットの呼び名を決めておき、区別したほうが作業しやすい。デフォルトは、先頭の画像ファイル名になる。私は、Gray for 3Dや Color series などと呼び名を付けている。<br>
1. 連続JPEG画像の読み込みには、フォルダごとドラッグする。または、最初の1枚をドラッグする。<br>
2. 新しいウィンドウ<code>Select a reader</code>が出る。プルダウンメニューより、<code>Any data</code>を選び、<code>OK</code>。<br>
3. 新しいウィンドウ<code>Add data into the scene</code>がでる。ここで、自動で連続画像を認識するはずだが、念の為、<code>Show options</code>にチェックをいれてオプション表示させ、<code>Single file</code>に<strong>チェックがないこと</strong>を確認する。<br>
4. 同じウィンドウで、連続画像の呼び名を付けられる。ウィンドウ<code>Add data into the scene</code>において、呼び名を入力する。名付けはあとで変更でき、<code>Module</code>, <code>Volumes</code>, <code>Active volume</code>のプルダウンメニュー、<code>Rename current volume</code>で変更する。<br>
</span></p>
</li>
</ol>
<h3 id="setting-up-serial-images">Setting up serial images/連続画像の設定</h3>
<ol>
<li>Voxel size: Module &gt; <code>Volumes</code>, ▽<code>Volume information</code> &gt; <code>Image Spacing</code>. Input voxel size. XY are pixel size of images (µm/pixel), and Z is thichness of sectioning.</li>
<li>
<p>Gradation: Module &gt; <code>Volumes、Threshold</code>. Input 0-255 for JPEG or Auto. (Dafault is ±1000 which should be suitable for CT iamge.) Settings here are used in Module &gt; <code>Volume Rendering</code> automatically, and coloring process is optimized.</p>
<p><span style="color:#444C99;">
<br>
設定するのは２種類で、ボクセルサイズと階調数。<br>
1. ボクセルサイズは、モジュール<code>Volumes</code>, ▽<code>Volume information</code>で、<code>Image Spacing</code>に、入力する。XYは画像のピクセルサイズ、Zは切削厚。<br>
2. 階調数は、モジュール<code>Volumes、Threshold</code>で、JPEGなら、0-255。Autoにすると、0-255になる。デフォルトはCT値っぽい、±1000になってしまう。ここで設定した階調数は、<code>Module</code> <code>Volume Rendering</code>に連動していて、そのときの色付け作業が容易になる。<br>
</span></p>
</li>
</ol>
<h3 id="volume-rendering">Volume Rendering</h3>
<h4 id="essentials">Essentials/準備とツール</h4>
<p><img alt="segmetation" src="../img/3dslicer_VR.png" /></p>
<p><em>Eye mark and centering button/眼のマークと中央寄せマークです</em></p>
<ul>
<li>Serial images in grayscale </li>
<li>Module &gt; <code>Volume Rendering</code></li>
<li><code>Eye mark</code> for ON/OFF. <span style="color:#444C99;">眼のマークで表示をON/OFFする</span></li>
<li><code>Centering</code> buttomn. <span style="color:#444C99;">青画面左上、中央寄せマーク</span></li>
<li><code>Scroll your mouse</code> for zoom in/out <span style="color:#444C99;">マウススクロールで拡大縮小</span></li>
<li><code>Left drag</code> for change orientation <span style="color:#444C99;">マウス左ドラッグでつかんで回す</span></li>
<li><code>Volume</code> for select sets. <span style="color:#444C99;">複数の連続画像セットを読み込んでいる場合、<code>Volume</code>のプルダウンより、表示させたい連続画像セットを選択する。</span></li>
<li>Display &gt; <code>Rendering</code> for select GPU if you have dGPU. <span style="color:#444C99;">プルダウンより、dGPUがあれば、GPUを選んだ方が動作が安定する</span></li>
</ul>
<h4 id="coloring">Coloring/色付け</h4>
<p><img alt="Volume_Rendering_Coloring" src="../img/3dslicer_color.png" /></p>
<p><em>The procedure is to create like this</em></p>
<p>In the tab <code>Advanced...</code></p>
<ol>
<li>Color: <code>Scalar Color Mapping</code>: Points can be added by clicking on the fradation bar. Select point and  choose color from squere color button, next to <code>Point number</code>. Point selection and color seletion can be done from small pull-down window at the right-top corner. In the example above, 3 points were added between darkest and brightest. Brighter point is colored in red for vasculature, middle in yellow for cardiac muscle, and darker in blue for adipose tissue.</li>
<li>Opacity1 <code>Scalar Opacity Mapping</code>: Change opacity in a small area. Points on the line can be added by clicking. To change opacity, grab these points or input value at the right top corner of the graph. Points can be deleted by <code>delete</code> key.</li>
<li>Opacity2 <code>Gradient Opacity</code>: Change opacity in a wide area. Points at both ends can be grab and moved. Points on the line can be added by clicking. To change opacity, grab these points or input value at the right top corner of the graph.</li>
<li>
<p>Overlay MPR in 3D view (optional): <code>Pin like mark</code> in R, G, Y window expand menu, and <code>Eye mark</code> switch ON/OFF of overlay. </p>
<p><span style="color:#444C99;">
<br>
1. 色の指定　<code>Scalar Color Mapping</code>。点をダブルクリック、または点をクリックして選択しておいて、<code>Point</code>の隣のボタンで、<code>色</code>を指定する。Point選択や色指定は、右上のプルダウンメニューからもできる。（今回は3色指定した。血管の明るいシグナルは赤、心筋を黄色、脂肪の暗いシグナルを青に。）<br>
2. 次に透明度（各領域）を決める　<code>Scalar Opacity Mapping</code> 点をつかんで移動する。または、点をクリックして、<code>O</code>に数値入力。点は追加できる。ライン上でクリック。点を削除するときは、キーボードのdelete。<br>
3. 最後に、全体的な透明度　<code>Gradient Opacity</code>、両端の2点は、クリックして、数値入力。ライン上をクリックすると、点を追加できる。 追加した点は、つかんで調節するか、数値を入力するか、どちらでもよい。<br>
4. 面をVolume rendering像にかさねて表示することもできる。各画面の押しピンマーク<code>Pin like mark</code>から眼のマーク<code>Eye mark</code>で表示ON/OFF。
</span></p>
</li>
</ol>
<h4 id="tips">Tips</h4>
<ul>
<li>Somewhat heavy sometime: Lower the quality of display. Go to Module &gt; <code>Volume Rendering</code>&gt; <code>Advanced</code>&gt; <code>Techniques</code>&gt; <code>Quality</code>. Select <code>Normal</code> rather than <code>Adaptive</code>(default). Even Normal gives enough quality. Never use <code>Maximum</code>! because it results in freezing.</li>
<li>
<p>Only 3D view is frozen sometime. Try <code>Pin like mark</code> &gt; <code>Auto rotation</code> once, or wait for a while.</p>
<p><span style="color:#444C99;">
<br>
なんだか重いときは、表示画質をさげてみる。モジュール<code>Volume Rendering</code>&gt; <code>Advanced</code>&gt; <code>Techniques</code>&gt; <code>Quality:</code>で、描出の質を3種から選べます。もっとも動作が軽快な<code>Normal</code>を選んでみる。デフォルトは<code>Adaptive</code>。<code>Maximum</code>はかなり重いようでほぼ固まります。3種どれでも画質はほとんで変わらず、Normalで十分きれいに描出するようです。<br>
たまに青画面3D viewだけ、固まることがある。カーソルでは3Dイメージをぐりぐりできなくなる。ビューワのメニュー（押しピンマーク<code>Pin like mark</code>）から、<code>Auto rotation, 自動回転ボタン</code>を選んで、動かしてみると、カーソルが復帰する場合がある。それでもだめなら、しばらく待つと直っている。
</span></p>
</li>
</ul>
<h3 id="keep-scenes">Keep scenes/表示位置を記録</h3>
<p>Module <code>Scene Views</code> can keep the scenes you made. In the 3D view and RGY windows, the positions of images can be kept and restored. Positions are kept but coloring is not. When I tried restoration, the app crashed（2022.3, v4.11, macOS12.3, iMac2017). </p>
<ol>
<li>Module &gt; <code>Scene Veiws</code>, or <code>A mark next to camera mark</code>. </li>
<li>Popup window <code>3D Slicer SceneView</code>. </li>
<li>Select windows to be kept. R, G, Y, or B, then <code>OK</code> to keep as a scene.</li>
<li>
<p>For restoration, go to Module <code>Scene Veiws</code>, or <code>`A mark two places next to camera mark</code>.</p>
<p><span style="color:#444C99;">
<br>
モジュール<code>SceneView</code>で表示位置を保存できる。3D viewやRGY windowでの表示位置を保存しておくと、いつでも戻ってこられる。ただし、戻ろうとRestoreすると、アプリが落ちる（2022.3, v4.11, macOS12.3, iMac2017）。また、色付けの調整などは保存されない。<br>
1. モジュール<code>Scene Veiws</code> または、<code>カメラマークの右隣のマーク</code>より。<br>
2. 新しいウィンドウ<code>3D Slicer SceneView</code>がでる。<br>
3. 保存したい画面（R, G, Y, B）を指定できる。<br>
4. 保存したSceneを読み込むときは、モジュール<code>Scene Veiws</code> または、<code>カメラマークのふたつとなり</code>で、Restore<br>
</span></p>
</li>
</ol>
<h3 id="movie-creation-by-os">Movie creation by OS/簡易的な動画制作</h3>
<p>Movies can created by OS funtion. The advantage is that every movement can be recorded easily. The disadvantage is that the 3D image is moved with a mouse or trackpad, which can be a bit unsteady, and also there is frame dropping.</p>
<ul>
<li>macOS: Screen Shot（Applications&gt; Utilities&gt; ScreenShot.app） can save movies and images as you see on the screen. </li>
<li>
<p>Windows10: Game Bar（Windows button+G, Setting&gt; Game Bar&gt; ON) for movie, Snipping Tool for still images. </p>
<p><span style="color:#444C99;">
<br>
OS付属の機能を使用するメリットは、あらゆる動きが録画できること。デメリットは、マウスやトラックパッドで3Dイメージを動すので、少々ぎこちなさが残ること。また、コマ落ちする場合がある。<br>
* macOS付属Screen Shot（Applications&gt; Utilities&gt; ScreenShot.app）で動画と静止画を保存できる。<br>
* Windows10付属Game Bar（Windows button+G, Setting&gt; Game Bar&gt; ON）で録画、Windows付属Snipping Toolで静止画面を保存できる。<br>
</span></p>
</li>
</ul>
<h3 id="movie-creation-by-3d-slicer2016">Movie creation by 3D slicer/アプリ機能(2016年実装)で動画制作</h3>
<ul>
<li>ffmpeg must be installed in advance for movie export to work</li>
<li>For a simple rotation only or a simple browsing serial images, only one step (module <code>Screen Capture</code>) can produce a simple movie.</li>
<li>For a complex movement, the work is done in two steps: in step 1, the operation is recorded (module <code>sequences</code>), and in step 2, the recorded sequences are recalled and export to a movie file (module <code>Screen Capture</code>).</li>
<li>I usually create videos and images with various patterns (volume rendering with different colors, cross-sectional display on/off, segmentation on/off, etc.) and edit them using movie editing apps (iMovie, Adobe Premiere, etc.).</li>
<li>This chaptor shows how to record the scenario "display and flip the Red horizontal plane in Blue, display and flip the Green vertical plane in Blue, and display and rotate the VR in Blue", then export it to a movie.</li>
<li>
<p>3D slicer refers to the recording operations as <code>Sequence</code>, and the movie export as <code>Screen Capture</code>. This manual describes them as "Step 1: Recording operations" and "Step 2: Movie export", respectively.</p>
<p><img alt="Movie plan" src="../img/movie_plan.png" /></p>
<p><span style="color:#444C99;">
<br>
* 動画書き出しを機能させるには、事前にffmpegのインストールが必要。 <br>
* 単純な回転だけの動画や、単純なパラパラ動画なら、モジュール<code>Screen Capture</code>だけでできる。 <br>
* 複雑な動きを動画にする場合、作業は二段階あり、ステップ1で操作を記録し（モジュール <code>sequences</code>）、ステップ2で記録したsequenceを呼び出し、動画ファイルに書き出す（モジュール<code>Screen Capture</code>） <br>
* 動画や静止画を様々なパターン（色違いのVolume Rendering、断面表示のON/OFF、SegmentationのON/OFFなど）で作っておき、それらを素材として動画編集アプリ（iMovie, Adobe Premiereなど）で編集することが多い。<br>
* この手順書では、「Red 水平面をBlueに表示してめくる、Greenの縦断面をBlueに表示してめくる、VRをBlueに表示し回転」というシナリオで操作を記録し、動画に書き出す。<br>
* 3D slicerでは、操作の記録を<code>Sequence</code>、動画書き出しを<code>Screen Capture</code>と呼び、本手順書ではそれぞれを「ステップ1 操作を記録」、「ステップ2 動画を描き出す」として記す<br>
</span></p>
</li>
</ul>
<h4 id="install-ffmpegffmpeg">Install ffmpeg/事前準備、ffmpegのインストール</h4>
<p>ffmpeg is an add-on that converts frame images (PNG) to movie. 3D slicer generate serial PNG images, then convert to a movie file using the ffmpeg. If you try to export movie without ffmpeg, you will find error message as <code>Set Valid ffmpeg executable path!</code> in the <code>Advance</code> tab. Formally, there appeared a link <code>Help...</code>, and I could go to official instruction site. Currently (v4.11), the link doesn't work. Here is <a href=https://slicer.readthedocs.io/en/latest/user_guide/modules/screencapture.html#setting-up-ffmpeg>correct link to official instruction</a>. <br>
<strong>Notice:</strong> Installing ffmpeg may take long time, including Xcode update 30 min, homebrew install 30 min, ffmpeg 15 min...</p>
<ol>
<li>Open <code>Terminal.app</code></li>
<li>Install <code>Homebrew</code>. Go to <a href=https://brew.sh/>https://brew.sh/</a>, execute commands shown in the site in the <code>Terminal.app</code>. (If Homebrew is already installed, skip this step.)</li>
<li>During installation of Homebrew, <code>Xcode</code> installation or update may be requested. (If Xcode is up-to-date already, skip this step.)</li>
<li>Install <code>ffmpeg</code>. Execute <code>brew install ffmpeg</code> in the <code>Terminal.app</code>.</li>
<li>Intel mac：<ol>
<li>In the 3D slicer, Module &gt; <code>Screen Capture</code> &gt; <code>ffmpeg executable</code>. Input path to ffmpeg as <code>/usr/local/bin/ffmpeg</code>.</li>
</ol>
</li>
<li>Apple silicon mac: <ol>
<li>In the Terminal.app, execute <code>brew info ffmpeg</code> to look for path to ffmpeg. In my case, <code>/opt/homebrew/Cellar/ffmpeg/5.0.1</code> was shown.</li>
<li>In the 3D slicer.app, Module &gt; <code>Screen Capture</code> &gt; <code>ffmpeg executable</code>. Copy and paste the shown path. </li>
<li>Click a mark <code>...</code>, to look for executable file...<code>/opt/homebrew/Cellar/ffmpeg/5.0.1/bin/ffmpeg</code>...Here is ! </li>
<li>Click <code>Open</code> button to finish setting ffmpeg in the 3D slicer.</li>
</ol>
</li>
</ol>
<p><span style="color:#444C99;">
<br>ffmpegは、フレーム画像（連続 PNG）から動画に変換する追加機能。3D slicerアプリは、いったんPNG連続画像を生成してから、動画へと変換する。ffmpegをインストールしないで動画書き出しをやろうとすると、下記の手順ステップ2、▽<code>Advance</code>で赤字エラー<code>Set Valid ffmpeg executable path!</code>が現れる。その横にリンク<code>Help...</code>ができる。かつては、それをクリックすると3D Slicerサイトの解説ページにいけたが、2022.3 v4.11 ではリンクが微妙に切れている。こちらの<a href=https://slicer.readthedocs.io/en/latest/user_guide/modules/screencapture.html#setting-up-ffmpeg>新しい解説ページ</a>に従ってインストールする。ここではMacの手順を転記する。Intel MacとM1 macでは、ffmpegへのパスが異なるので注意。インストールには時間がかかる。Xcodeアップデート30分、homebrew30分、ffmpeg15分、計75分（自宅wifi夜）、大学LANでも合計16分間かかった。
</span></p>
<ol>
<li><span style="color:#444C99;">アプリ<code>Terminal</code>を起動</span></li>
<li><span style="color:#444C99;"><code>Homebrew</code>をインストールする。こちらのサイト（<a href=https://brew.sh/>https://brew.sh/</a>）に記載のコマンドを<code>Terminal</code>に打つ。（すでにHomebrewをインストールしていれば不要）</span></li>
<li><span style="color:#444C99;">Homebrewをインストールするとき、<code>Xcode</code>インストールまたはアップデートも要求された場合はそれに従う。（既にアップデートしてあれば不要）</span></li>
<li><span style="color:#444C99;"><code>ffmpeg</code>をインストールする　<code>brew install ffmpeg</code> を<code>Terminal</code>に打つ（6分かかった。2022.5）</span></li>
<li><span style="color:#444C99;">Intel macの場合：</span><ol>
<li><span style="color:#444C99;">3D slicerのモジュール<code>Screen Capture</code>に戻って、<code>ffmpeg executable</code>の欄に、ffmpegのアドレス <code>/usr/local/bin/ffmpeg</code> を入力する</span></li>
</ol>
</li>
<li><span style="color:#444C99;">M1 macの場合（インストール先やバージョンが違うらしい 2022.5.26)</span><ol>
<li><span style="color:#444C99;">Terminal.appで、<code>brew info ffmpeg</code>をうって、ffmpegへのパスを探すと、<code>/opt/homebrew/Cellar/ffmpeg/5.0.1</code>と表示される</span></li>
<li><span style="color:#444C99;">3D slicer.appで、<code>ffmpeg executable</code>の欄に上記の表示されたアドレスをコピペ</span></li>
<li><span style="color:#444C99;"><code>...</code>マークを押して別ウィンドウ。実行ファイルを探すと<code>/opt/homebrew/Cellar/ffmpeg/5.0.1/bin/ffmpeg</code>にあった！<code>Open</code>ボタンをおして指定する</span></li>
<li><span style="color:#444C99;">これで動画書き出しができるようになります。</span></li>
</ol>
</li>
</ol>
<h4 id="step-1-recording-operations">Step 1: Recording operations/操作を記録</h4>
<p>Operation on each window (Red, green, yellow, blue) can be recorded. In this example, the following scenario is recorded using <code>Sequence browser</code>: "Red shows transverse planes, displayed in blue, and browsed. Green shows frontal planes, displayed in blue and browsed. VR is shown in blue and rotated".</p>
<ol>
<li>
<p>Select display mode
    In this example, red , green, and blue windows are recorded. 4 window mode, for example, Conventional, Conventional widescreen, or Four Up etc. may be suitable. The display mode selected here are only used for recording, not for movie export. For movie export, select adequate mode such as 3D only. </p>
<p><img alt="Window styles" src="../img/window_style.png" /></p>
</li>
<li>
<p>Go to module: <code>Sequences</code></p>
</li>
<li>Tab <code>Browse</code> &gt; pull-down <code>Sequence browser</code> &gt; <code>Create new sequence browser as...</code>. In the Pop-up window <code>Rename sequence</code>, input name of sequence as "2-planes-rotate" for this example.</li>
<li><code>Synchronized nodes</code>; Specify 3 windows to be recorded in this example. (Red for browsing horizontal images, Green for browsing vertical image, and Blue for rotating volume rendered image.)</li>
<li>Press button <code>PLUS in green</code> for 3 times to make <code>sequence</code>（こんかいは、3回押して、上記3種のウィンドウを指定する）</li>
<li>For each <code>sequence</code>, set <code>Proxy node</code> as <code>Red</code> (Red window), <code>Green</code>(Green window), and <code>Camera</code> (blue window, 3D view), respectively. Note that there are some <code>camera</code> in the pull-down menu. one <code>Camera</code> can record, but another <code>Camera</code> cannot. Just try. </li>
<li>Tab <code>Browsing</code>. Start recording by pushing button <code>Circle in red</code>. Stop recording is alos <code>Circle in red</code>. Only operating time is recorded and resting time is not. （Browsing in Red, browsing in green, and rotate VR image in blue.</li>
<li>
<p>Tab <code>Browsing</code>. Replay sequence to check. Press button <code>Triangle in green</code> to replay, press again <code>Triangle in green</code> to stop.</p>
<p><img alt="Brows and Sybchronized nodes" src="../img/sequences.png" /></p>
</li>
</ol>
<p><span style="color:#444C99;">
<br>操作している様子を記録できる。画面（Red, green, yellow, blue）を指定できる。ここでは「Red 水平面をBlueに表示してめくる、Greenの縦断面をBlueに表示してめくる、VRをBlueに表示し回転」というシナリオ（<code>Sequence browser</code>）を例として、操作を記録する</span></p>
<ol>
<li>
<p><span style="color:#444C99;">表示スタイルを選ぶ</span></p>
<ul>
<li><span style="color:#444C99;">本例では、赤画面、緑画面、青画面を使いたいので、4画面表示（Conventional, Conventional widescreen, Four Upなど）を選ぶ。ここで選ぶのは操作記録用の表示スタイルで、目的の操作がしやすければ何でも良い</span></li>
<li><span style="color:#444C99;">のちのステップ2、動画を書き出す際は、動画書き出しに適した表示スタイルに変更する（3D onlyなど）。</span></li>
</ul>
</li>
<li>
<p><span style="color:#444C99;">モジュール<code>Sequences</code></span></p>
</li>
<li><span style="color:#444C99;">タブ<code>Browse</code>, プルダウン<code>Sequence browser</code>より、<code>Create new sequence browser as...</code>, 新しいウィンドウ<code>Rename sequence</code>で、名前を決めて入力する（本例では、「2-planes-rotate」と名付けた）</span></li>
<li><span style="color:#444C99;">▽ <code>Synchronized nodes</code> （本例では、3種類のウィンドウ「赤画面で画像をめくる」「緑画面で画像をめくる」「青画面3D viewでVolume Rendering像を回転」を記録する）</span></li>
<li><span style="color:#444C99;">ボタン<code>Green PLUS</code>で <code>sequence</code>をつくる。（こんかいは、3回押して、上記3種のウィンドウを指定する）</span></li>
<li><span style="color:#444C99;"><code>Proxy node</code>を設定、各<code>sequence</code>に、赤画面<code>Red</code>, 黄画面<code>Green</code>, 青画面<code>Camera</code>を設定。（プルダウンには Camera が複数あって、記録されるCameraと記録されないCameraがある、らしい。いちどやってみて、ダメなら順に選んで試す）</span></li>
<li><span style="color:#444C99;">▽ <code>Browsing</code>, ボタン<code>Red CIRCLE</code>で記録開始する。停止も<code>Red CIRCLE</code>。動かしている時間だけ記録される。静止している時間は記録されない、らしい。（「1. 赤で画像をめくる、2.黄で画像をめくる、3.3D viewでVolume Rendering像を動かす」）</span></li>
<li><span style="color:#444C99;">▽ <code>Browsing</code>, ボタン<code>Green TRIANGLE</code>で再生し、記録した操作を確認する。停止もボタン<code>Green TRIANGLE</code></span></li>
</ol>
<h4 id="step-2-movie-export">Step 2: Movie export/動画を書き出す</h4>
<p>The operation recorded in <code>Sequence browser</code> in Step1 can be exported into movie file (mpeg4). Basing on one recorded operation, some kinds of movies can be generated by choosing display VR ON or OFF, and display planes ON or OFF. Movies to be generated have the same pixel size and shape as same as blue window displayed.</p>
<ol>
<li>Module: <code>Utilities</code> &gt; <code>Screen Capture</code></li>
<li>
<p>Setting up ▽ Input</p>
<ul>
<li><code>Master View:</code> In this example, select <code>View 1</code> for exporting blue window. If you display multiple blue windows, select adequete View from View1, 2, 3...</li>
<li><code>Animation mode:</code> Select <code>sequence</code> (for this example), to create a movie from a sequence recorded in step 1.  If you select <code>3D rotation</code>, a simple roteting movie will be created without using the recorded <code>sequence</code>.</li>
<li><code>Sequence:</code> Specify the <code>sequence</code> recorded in step 1. In this example, "2-planes-rotate" is specified.</li>
<li><code>Start index:</code>, <code>Stop index:</code> It is possible to specify where in the recorded sequence to be used. In this example, the first 19 frames are not used and Start is set to 20. Stop was not changed and remained at 1170, which was adopted until the end of the sequence. </li>
</ul>
</li>
<li>
<p>Settin up ▽ Output</p>
<ul>
<li><code>Output type:</code>　Select <code>Video</code> for creating movie file. Once PNG files are created, converted into mpeg4 automatically, and original PNGs are discarded. In case of <code>Image series</code>, serial PNGs are created and saved.</li>
<li><code>Number of images</code>, <code>Video length</code>, <code>Video frame rate</code>: In this example, set as 300 flames, 10 sec, 30 flames/sec.</li>
<li><code>Output directory</code> and <code>Output file name</code> : Set up directory and file name to be saved.</li>
</ul>
<p><img alt="Screen Capture" src="../img/screen_capture.png" /></p>
</li>
<li>
<p>Change display mode desirable for movie export</p>
<ul>
<li>The size and shape of the exported video will reflect the state of the displayed blue window. In this example, I want to export only the blue window, so I set the display mode to "3D only" and adjust the size and aspect ratio as desired. It should be convenient to save the display state at this time in Scene View, but the application may crash when Restore is performed.</li>
</ul>
</li>
<li>
<p>Select items to be deisplayed and exported.</p>
<ul>
<li>In the Red and Green windows, select a set of serial images (color or grayscale). </li>
<li>Go to Module <code>Sequence</code> &gt; <code>Proxy node</code>. Check or uncheck <code>Play</code> for display ON or OFF (2022.8 v5.0). Note that <code>Pin-mark</code>, <code>Pull-down next to eye-mark</code>, and <code>Eye-mark</code> do not work for the purpose of exporting movie (2021 v4.11).</li>
<li>Go to Module <code>Volume Rendering</code> &gt; <code>Volume:</code> &gt; <code>Eye-mark</code>. Select volume rendered image and ON or OFF display.</li>
<li>(If you display segments, go to Module <code>Segmentations</code> and select ON/OFF.)</li>
<li>Go back to Module <code>Screen Capture</code>.</li>
</ul>
</li>
<li>
<p>Export</p>
<ul>
<li>Module <code>Screen Capture</code>.</li>
<li>Button <code>Capture</code>: Start creating movie. Status is indicated in the small window, and shows <code>Done</code> when finisied. It may take a long time, depending on PC specs.</li>
<li>(Button <code>ARROW</code> (next to Capture)  is a shortcut to movie fifle created.)</li>
</ul>
</li>
</ol>
<p><span style="color:#444C99;">
<br>
記録した操作（ステップ1で作った<code>Sequence browser</code>）から、動画ファイル（mpeg4）を書き出す。ひとつの操作記録から、多様な動画を描き出せる。例えば、表示VRを切り替えたり、表示断面像の切り替えたり、それらの表示／非表示を選んだりできる。生成される動画の大きさと形は、表示させているウィンドウの大きさと形を反映したものになる。</span></p>
<ol>
<li><span style="color:#444C99;">モジュール<code>Utilities</code> &gt; <code>Screen Capture</code></span></li>
<li>
<p><span style="color:#444C99;">▽ Inputの設定</span></p>
<ul>
<li><span style="color:#444C99;"><code>Master View:</code> 本例では、青画面3D viewを記録したいので<code>View 1</code>を選ぶ。もし複数の青画面を表示させているなら、View1, 2, 3...から適切な青画面を選ぶ</span></li>
<li><span style="color:#444C99;"><code>Animation mode:</code> ステップ1で記録した <code>sequence</code>を呼び出して動画にする場合は、<code>sequence</code>を選ぶ（本例ではこちら）。<code>3D rotation</code>の場合、単純な回転動画が生成され、記録した<code>sequence</code>を必要としない。</span></li>
<li><span style="color:#444C99;"><code>Sequence:</code> ステップ1で記録した <code>sequence</code> を指定する。本例では「2-planes-rotate」を指定した。</span></li>
<li><span style="color:#444C99;"><code>Start index:</code>, <code>Stop index:</code> 記録したsequenceのどこを利用するか指定できる。本例では最初の19フレームを不採用にして、Startは20からとした。Stopは変更せず、1170のまま、最後まで採用した。 </span></li>
</ul>
</li>
<li>
<p><span style="color:#444C99;">▽ Outputの設定</span></p>
<ul>
<li><span style="color:#444C99;"><code>Output type:</code>　動画書き出しの場合<code>Video</code>を選択する。PNG連続画像を生成した後、動画mpeg4に変換してくれる。<code>Image series</code>の場合、PNG連続画像を生成する</span></li>
<li><span style="color:#444C99;"><code>Number of images</code>, <code>Video length</code>, <code>Video frame rate</code>を設定する。本例では300flames, 10sec, 30flames/secとした。（設定に関するヒントは下記参照）</span></li>
<li><span style="color:#444C99;"><code>Output directory :</code>, <code>Output file name :</code> 保存場所とファイル名を設定する</span></li>
</ul>
</li>
<li>
<p><span style="color:#444C99;">表示スタイルを選ぶ</span></p>
<ul>
<li><span style="color:#444C99;">書き出される動画の大きさと形状は、表示されている状態を反映する。本例では青画面だけを書き出したいので、表示スタイルは、「3D only」にして、大きさと縦横比を好みに合わせる。このときの表示状態をScene Viewに保存しておくと便利だが、Restore時にアプリが落ちることがある</span></li>
</ul>
</li>
<li>
<p><span style="color:#444C99;">表示させたいものを選ぶ</span></p>
<ul>
<li><span style="color:#444C99;">赤画面、緑画面などで表示させる連続画像（カラー、グレーなど）を選べる。2021: 各画面の<code>押しピンマーク</code>、<code>眼マークの隣のプルダウン</code>、<code>眼マーク</code>で設定する（これは効かない!）。2022.8: ステップ1の、モジュール<code>Sequence</code>、<code>Proxy node</code>でRedやYellowを設定したところ、右側の再生チェックを外す。</span></li>
<li><span style="color:#444C99;">Volume Renderingを選んだり、表示／非表示を選べる。モジュール<code>Volume Rendering</code>にて、<code>Volume:</code>, <code>眼マーク</code>で設定する。選び終えたら、モジュール<code>Screen Capture</code>に戻る</span></li>
<li><span style="color:#444C99;">セグメンテーションがあれば、モジュール<code>Segmentations</code>にて、各セグメントの表示／非表示を選べる。選び終えたら、モジュール<code>Screen Capture</code>に戻る</span></li>
</ul>
</li>
<li>
<p><span style="color:#444C99;">書き出し</span></p>
<ul>
<li><span style="color:#444C99;">（モジュール<code>Screen Capture</code>に戻って）</span></li>
<li><span style="color:#444C99;">▽ Outputの、ボタン<code>Capture</code>で、書き出しを開始する。下の小窓にステータスが表示され、完了すると<code>Done</code>と表示される。時間がかかる</span></li>
<li><span style="color:#444C99;">（ボタン<code>ARROW</code>（Capture隣）は、書き出した動画ファイルへのショートカット）</span></li>
</ul>
</li>
</ol>
<h4 id="tips_1">Tips/ヒント</h4>
<ul>
<li>
<p>Generally, video has 30 frames/second. 150 PNGs are generated for a 5-second video, or 300 PNGs for a 10-second video, and converted to video. 300 PNGs takes a long time. GPU and single-core work for PNG generation, multi-core for video conversion from serial PNGs. The time required depends on the specs of your computer, and the time you can wait varies from person to person. First, try less than 100 images, then adjust the settings and try again and again.</p>
<p><span style="color:#444C99;">一般のビデオは、30 frame/secondである。5秒動画ならPNG150枚や、10秒動画ならPNG300枚が生成され、動画に変換される。300枚ともなると、だいぶ時間がかかる。PNG生成ではGPUとシングルコアが働き、連続PNGからの動画変換でマルチコアが働く。かかる時間は、パソコンのスペックによるし、待てる時間はひとそれぞれ。まずは100枚以下で様子を見てから、設定を調整し、何度かためしてみる</span></p>
</li>
<li>
<p>It takes time if the window you want to capture (make into a movie) is displayed in a large size.</p>
<p><span style="color:#444C99;">キャプチャしたい（動画にしたい）ウィンドウを大きく表示していると、時間がかかる</span></p>
</li>
<li>
<p>It takes time when both Volume Rendering and Segments are displayed.</p>
<p><span style="color:#444C99;">Volume Renderingも、Segmentsも両方表示していると、時間が掛かる</span></p>
</li>
<li>
<p>It should be useful to record positions in the SceenView. However, Restore is unstable.</p>
<p><span style="color:#444C99;">位置をScreenViewに保存しておくと便利なはずだけど、Restoreするとアプリがクラッシュする。まだ不安定なようで残念（2022）。</span></p>
</li>
</ul>
<h3 id="save-data">Save data/保存</h3>
<p>There are 2 ways to save. One can save images and processed data into a single file, and anothor saves as multiple files. </p>
<h4 id="save-everything-as-a-single-file">Save everything as a single file</h4>
<p>A single file with extention .mdb contains serial images, segmentation, scene, etc. This file format is recommended in the official site.</p>
<ol>
<li>Icon <code>SAVE</code>: New window <code>Save Scene and Unsaved Data</code> appears.</li>
<li>Press icon <code>Present box-like</code> to be active to select mrb file format.</li>
<li>Select directory. Note: External disc can be selected from a mark <code>...</code> (right of the file). The button <code>Change directory for selected files</code> doesn't work (Maybe a bug, v4.11).</li>
<li>To opne mrb file, drag and drop the mrb file into 3D slicer window. The working status at the time of saving is restored.</li>
</ol>
<h4 id="save-each-processed-data-into-individual-files">Save each processed data into individual files.</h4>
<p>There are some advantages, and I would personally recommend this format, though it requires some practice. Among the files generated, .mrml (scene settings), .png (scene, icon substitute), and .nrrd (serial image) are essential. If the image is being processed, additional files will be generated, such as .seg.nrrd (a file of segments) and .h5 (Transform data). The "scene" is the status of the window you were working on (.mrml) and the appearance (.png). The appearance png image helps to remember what I was doing last time. The situations where individual files are useful is as follows; when you want to apply the same processing to multiple datasets, for example, when you want to apply the same coloring to multiple samples in volume rendering, or when you want to do the segmentation in a rough serial images and migrate the segments into the fine serial images. Another advantage is that overwrite saving is faster.</p>
<ol>
<li>Icon <code>SAVE</code>: New window <code>Save Scene and Unsaved Data</code> appears.</li>
<li>Press icon <code>Present box-like</code> to be inactive.</li>
<li>Select directory. Files with .mrml, .png are saved in /Data. Serial images and processing data is saved in a folder "Data". When you change directory from default, keep directory structure. A mark <code>...</code> can change directories for each files. A button <code>Change directory for selected files</code> can change directory for all files at once.</li>
<li>To open all files, drag and drop only a .mrml file into 3D slicer window. Other processing data are automatically linked and open at the same time. Note that keep directory structure needs to be maintained.</li>
<li>To save modified data only, use button <code>SAVE</code>. In the appeared window, check left button <code>Select Scene &amp; Modidied Data Only</code>. Then, .mrml(Scene settings), .png (Scene), and modified files are saved. Adjacent <code>Modidied Data Only</code> can save only modified data but not mrml.</li>
<li>Tip: File name of segments are [Active segmentation].seg.nrrd. Active segmentation was made at Module: <code>Segmentations</code> &gt; <code>Create New Segmentations</code> to group multiple segments.</li>
</ol>
<p><span style="color:#444C99;">
<br>
2通りある。画像データや作業内容を、まとめてひとつのファイルとして保存する方法と、個別にする方法がある</span></p>
<h4 id="_1">画像データも作業内容もひとつのファイルに保存する（公式サイトでは推奨）</h4>
<p><span style="color:#444C99;">拡張子はmdb。画像、着色、シーンなどの設定を一括して保存できる</p>
<ol>
<li><span style="color:#444C99;">アイコン<code>SAVE</code> ウィンドウの左上。新しいウィンドウ<code>Save Scene and Unsaved Data</code>がでてくる。</span></li>
<li><span style="color:#444C99;">プレゼント箱みたいなアイコン<code>Present box-like</code>をONにして、mrbを指定</span></li>
<li><span style="color:#444C99;">保存先を指定する。外付けディスクを指定する場合だけ注意：ファイル右横のマーク<code>...</code>から指定すること。下のボタン<code>Change directory for selected files</code>では指定できない。</span></li>
<li><span style="color:#444C99;">開くときは、mrbファイルを3D slicer のウィンドウへ、ドラッグ&amp;ドロップする。保存したときの作業状態が再現される。</span></li>
</ol>
<h4 id="_2">作業内容を個別に保存する（なにかとメリットはある）</h4>
<p><span style="color:#444C99;">生成されるファイルのうち、.mrml（シーン設定）、.png（シーン、アイコンの代わり）、.nrrd（連続画像）は、必須のファイル。もし、作業していれば、.seg.nrrd（セグメントをまとめたファイル）や、.h5（Transformのファイル）など追加で生成される。シーンとは、作業していたウィンドウの状況.mrmlと、見た目.pngのことである。見た目のpngのおかげで、次に開くときに作業内容を思い出しやすい。個別ファイルが使いやすい場面として、複数サンプルに同一処理、たとえば、Volume Renderingで、複数サンプルに同じ着色をしたいときや、セグメンテーションは軽い連続画像でやっておいて、できあがったらセグメンテーションだけを重い連続画像と合わせたいときが考えられる。また、上書き保存が速いというメリットもある。</span></p>
<ol>
<li><span style="color:#444C99;">アイコン<code>SAVE</code> ウィンドウの左上。新しいウィンドウ<code>Save Scene and Unsaved Data</code>がでてくる。</span></li>
<li><span style="color:#444C99;">mrbをOFF。<code>プレゼント箱ボタン</code></span></li>
<li><span style="color:#444C99;">保存先はデフォルトなら、.mrml, .png, /Data。連続画像と作業ファイルは「Data」フォルダに保存される。変更してもよいが、階層構造をのちのち保つこと。変更する場合は、マーク<code>...</code>で個別に、下のボタン<code>Change directory for selected files</code>で一括して行う</span></li>
<li><span style="color:#444C99;">開くときは、.mrmlファイルのみを3D slicerのウィンドウにドラッグドロップする。ほかはリンクされていて、自動で一括して開かれる。ただし、保存時の階層構造を保っておく必要がある。</span></li>
<li><span style="color:#444C99;">上書き保存では、ボタン<code>SAVE</code>をおすと、別ウィンドウがでて、左のボタン<code>Select Scene &amp; Modidied Data Only</code>にチェックが入っている。これで、.mrml（シーン設定）、.png（シーン、アイコンの代わり）と、更新したファイルのみが保存される。となりの<code>Modidied Data Only</code>にすると、シーンが更新されない。</span></li>
<li><span style="color:#444C99;">ヒント：Segmentのファイル名は、[Active segmentation].seg.nrrdになっている。モジュールSegmentationsでCreate New Segmentationsでつくった名称＝複数のセグメントをまとめているところの名称。</span></li>
</ol>
<h3 id="segmentaion">Segmentaion/セグメンテーション</h3>
<ul>
<li>Here I show a simple example to perform segmentation manually in 3Dslicer using minimal tools. Tools used here are only <code>Paint</code>, <code>Fill between slices</code> and <code>Smooth</code>. 3D slicer is equipted many usefull functions for segmentation, such as select specific brightness, restrict working area, and so on. For dealing with CoMBI data, a full-color image series, <code>Paint</code> and <code>Draw</code> are usefull at first.</li>
<li>Automatic or semi-automatic segmentation are possible by using iLastik, which conducts segmentation by machine learning, and produce binary or grayscale image series. See other page <a href="../ilastik/index.html">"Segmentation by iLastik"</a>. Photoshop also helps segmentation by color specification, and produse binary image series. See the section in other page; <a href="../horos/index.html#3">Horos, section "color specification"</a>. The binary or grayscale image series are loaded into 3D slicer and used for segmentation and volume rendering.</li>
<li>Pen tablets are highly recommended. Else, iPad + Apple pencil + Sidecar is also useful. My favorite is use of a pen tablet (Wacom Intuos Pro). Pen tablet has hovering function, while iPad+Apple pencil do not. Hovering allow to follow the tip of the pen all the time. iPad+ApplePencil is recommended to use via USB cable for its stability. Some Windows laptop have touch panel and seems to be usefull but I do not have one.</li>
<li>Segmentaion data are stored in mrb file or saved as separated file. The separated files can be imported into other mrb. Since the segmentation is heavy duty, I often perform it using the rough and light dataset, then import segments into the fine and heavy dataset.</li>
<li>
<p>I wrote this manual using data of chick heart at first. Later, I added <code>Fill between slices</code> and <code>Smooth</code>, using mouse E12 midgud. Sorry, these may confuse you, but this manual basically describes how to segment vessels in chick heart as shown below.</p>
<p><img alt="segmetation" src="../img/3dslicer_seg.png" /></p>
<p><em>Segmentation of vessels of chick heart.</em></p>
<ul>
<li><span style="color:#444C99;">3Dslicerだけで手作業でSegmentationする手順を下に示します。使用するツールは、<code>Paint</code>と<code>Fill between slices</code>と<code>Smooth</code>だけにしてシンプルです。他に領域限局やシグナル強度の範囲指定など、さまざまなツールが備わっていますが、CoMBIのフルカラー画像なら、基本の<code>Paint</code>と<code>Draw</code>が役立つでしょう</span></li>
<li><span style="color:#444C99;">抽出したい対象物によっては、3D slicerだけでは不便な場合もあるでしょう。iLastikは、機械学習でSegmentationして、二値化やグレースケール連続画像をつくってくれます。こちらのページ<a href="../ilastik/index.html">「Segmentation by iLastik」</a>に記しました。また、Photoshopは、「色域指定」で二値化連続画像をつくれます。こちら<a href="../horos/index.html#3">Horosのページの中の「色域指定」</a>に記しました。iLastikやPhotoshopでつくった二値化やグレースケール連続画像は、3D slicerで<code>Volume Rendering</code>したり、<code>Segmentation</code>, <code>Threshold</code>を施したりします。</span></li>
<li><span style="color:#444C99;">推奨の作業環境は、タッチペンです。私はMacBookPro15 2018またはMacBookPro16 2021にiPad Pro 2018 A12X（SideCar）をつなげ、Apple Penで描いています。SideCarでの接続は、無線より有線のほうが安定します。Windowsノートなら元々タッチパネルになっている商品があって便利そうです。WindowsマシンにiPadをつなげるアプリもいくつかあるようですが、私は試していません</span></li>
<li><span style="color:#444C99;">Segmentaionのデータは、mrbファイルなら一括して保存されます。Segmentaionデータだけの独立ファイルとして保存することも選べます。その場合、別のmrbに移入させられます。Segmentation作業は必要最低限のデータセットで軽快に行い、本番用の重いデータセット（RGB, grayscale, ilastik, WT-Hetero-Knockoutなど）に移入させるといった使い方ができます</span></li>
<li><span style="color:#444C99;">本手順書は、はじめトリハツをつかった例で執筆しました。のちに<code>Fill between slices</code>と<code>Smooth</code>のところを追記し、マウスE12中腸が登場します。ややこしいですが基本的に上図のトリハツ大血管をセグメンテーションする手順です</span></li>
</ul>
</li>
</ul>
<h4 id="procedure-of-manual-segmentation-by-3dslicersegmentation">Procedure of manual segmentation by 3Dslicer/手作業でSegmentationする手順</h4>
<ol>
<li>Module <code>Segmentation</code> &gt; <code>Active segmentation:</code> &gt; <code>Create new segmentation</code>, or Module <code>Segment editor</code> &gt;<code>Segmentation:</code> &gt;<code>Create new segmentation</code>. The "segmentation" created here is like a folder, where multiple segments (ex. artey and vein) are stored. These 2 modules, <code>Segmentation</code> and <code>Segment editor</code> are highly relational modules. To move between the modules, use buttons <code>Segmentation...</code> and <code>Edit selected</code>. Please do not get lost.</li>
<li>Button <code>Add segment</code> creates new segment <code>Segment_1</code>. Name of segment can be changed as you like. In this example, I named as "Artery". Click <code>squere color button</code> to open color pallete and change the color of segment.</li>
<li><code>Paint</code> the artery.<ul>
<li>No need to paint all the images, but every 5 or 10 images. Even intervals are recommended, as they are easy to modify. Roughness is acceptable. Later, <code>Fill between slices</code> and <code>smooth</code> will be used.</li>
<li><code>Show 3D</code> display segments in the blue window (3D view) in real-time. In addition, if volume rendered image is displayed by Module <code>Volume Rendering</code>, you can confirm creating segments and 3D image at the same time. However, such display style is heavy duty. I usually create segments with nothing displayed in the blue window, and occasionally I check the segments and VR images in the blue window.</li>
<li>I used <code>Paint</code> instead of <code>Draw</code> because the large blood vessels in this example were ring-shaped. <code>Draw</code> is a mode that fills inside the drawn line. After drawing a line, pressing the Return key fills the inside of the line. You can draw either closed or open shapes (similar to the relationship between line and fill in PowerPoint and Illustrator).</li>
</ul>
</li>
<li><code>Erase</code> corrects the overpainted area.</li>
<li>
<p><code>Fill between slices</code> (Module <code>Segment Editor</code>)</p>
<p><img alt="Fill between slices" src="../img/fillbetweenslice1.png" /></p>
<p><em>Process of <code>Fill between slices</code>. Reference serial images are 5x5x10 µm/voxel, 1220x875 pixels, 820 images of mouse mid gut on E12 (Not chick heart). <code>Draw</code> in the RED plane for whole mid gut every 5 images, and in the YELLOW plane for in a loop every 10 images.</em></p>
<ol>
<li><code>Initialize</code>, wait for a while.</li>
<li><code>Show 3D</code> shows segmets in blue window. For checking quality of filling area, adjust opacity of painted segments and filling segments by sliding bar.</li>
<li>Correct painted segments using <code>Paint</code> and <code>Erase</code>. <code>Auto update</code> shows result of <code>Fill between slices</code> during correction process.</li>
<li><code>Apply</code> to finish. <code>Undo</code> can restore. Apply should be used after painting whole area of interest. After <code>Apply</code>, it is also possible to use <code>Erase</code> to correct in some extent. I have corrected odd protrusions and fusion of proximity structures. <code>Smooth</code> in the later step will correct roughness.</li>
</ol>
</li>
<li>
<p><code>Add segment</code> creates another <code>Segment_2</code>. In this example, I named it as "Vein", and <code>Paint</code> pulmonary artery and <code>Fill between slices</code>.</p>
</li>
<li>
<p><code>Smooth</code> corrects roughness. (Module <code>Segment Editor</code>)</p>
<p><img alt="Smooth comparison" src="../img/smooth.png" /></p>
<p><em>Comparison of smoothing methods and settings. Note that voxel size were set as 5x5x10 mm/voxel at volume module, instead of original 5x5x10 µm/voxel (millimeter instead of micrometer), for stabilize PC performance. Processing were done using MacBookPro16 M1 max. Time in yellow indicate duration of prosseccing after clicking <code>Apply</code>.</em></p>
<ol>
<li>I prefer Smoothing Method: <code>Joint smoothing</code>. Joint smoothing processes multiple segments in the display and takes less time. Median and Gaussian process only the selected segment and take longer. Values 1x1x1 shows no change, 3x3x1 erase only spikes. 7x7x7, 11x11x7, etc. are equivalent to Joint smoothing_0.5, but the processing time is very long.</li>
<li>Setting up <code>Joint smoothing</code>. Try default value 0.5 at first.</li>
<li><code>Apply</code></li>
<li>If you don't satidfy the result, <code>Undo</code>. Try again using values between 0.3-1.0.</li>
<li>If fine corrections are needed, use <code>Erase</code>, etc. together. The figure below shows an example of using <code>Erase</code> after <code>Smooth</code> to correct an undesired fusion between neighboring structures.</li>
</ol>
<p><img alt="Erase" src="../img/erase.png" /></p>
<p><em>Unwanted connection was erased in the RED plane using <code>Erase</code> tool, and visualized in 3D View. 赤画面において、不必要につながった場所をEraseで消した</em></p>
</li>
<li>
<p>For checking the segments, Volume Rendering and segments can be overlaid in the blue window. Module <code>Volume rendering</code> &gt; <code>Eye mark</code> turns ON/OFF of showing VR image. Module <code>Segment Editor</code> &gt; <code>Show 3D</code> display segments in the blue. Showing both VR and segments is heavy duty.</p>
</li>
<li><code>Camera</code> (Capture Screenshot) can save steal image.</li>
<li>When <code>Save</code> the data, select file format. Save segment in .mdb, or save segments as individual files. If you need to migrate segments into other datasets, save segments as individual files.</li>
</ol>
<hr />
<ol>
<li><span style="color:#444C99;">モジュール<code>Segmentation</code>の場合、Active segmentation: より、Create new segmentation。モジュール<code>Segment editor</code>の場合、Segmentation: より、Create new segmentation。ここで作るSegmentationは、フォルダのようなもの。フォルダの中に複数のSegment（例、動脈と静脈）が収まる。二つのモジュール<code>Segmentation</code>と<code>Segment editor</code>はほぼ一体のモジュールで、それらの間を行き来するには、ボタン<code>Segmentation...</code>やボタン<code>Edit selected</code>である。迷子にならないように</span></li>
<li><span style="color:#444C99;">ボタン<code>Add segment</code>で、新規セグメント<code>Segment_1</code>をつくる。名前は自由に変えられる。このときは大動脈を塗ることにしたので、名称を「Artery」とした。表示色を変えるには、四角い色表示をクリックする</span></li>
<li><span style="color:#444C99;"><code>Paint</code>で、大動脈を塗りつぶした</span><ul>
<li><span style="color:#444C99;">全画像で塗る必要はなく、5枚に1枚とか、10枚に1枚の画像で塗る。等間隔がおすすめ、修正しやすいため。とびとびでよいし、がたついても良く、のちに補完（Fill between slices)と平滑化（Smooth）で仕上げる</span></li>
<li><span style="color:#444C99;"><code>Show 3D</code>ボタンを押しておくと、青画面（3D view）にリアルタイムで表示されていく。さらに、モジュール<code>Volume Rendering</code>で、VR像も表示させると、セグメントと同時に確認できる。しかしながら、動作がかなり鈍くなるので、塗りつぶし作業中はShow 3D OFF、Volume renderingもOFFとしておき、ときどき確認するときだけ表示ONにしている</span></li>
<li><span style="color:#444C99;">今回の例題である大血管は輪状だったので、<code>Draw</code>ではなく、<code>Paint</code>を使った。<code>Draw</code>は、描いた線の内側をすべて塗りつぶすモード。使い方は、<code>Draw</code>+ <code>Return, Enter</code>。Drawで線を描いたあとにリターンキーをおすと、その内部が塗りつぶされる。描くのは、円形でも、弧でもよい（PowerPointやIllustratorの、線と塗りつぶしの関係と同様）。</span></li>
</ul>
</li>
<li><span style="color:#444C99;"><code>Erase</code>で塗りすぎたところを削除して、修正する</span></li>
<li>
<p><span style="color:#444C99;"><code>Fill between slices</code>で補完（モジュール<code>Segment Editor</code>）</span></p>
<p><img alt="Fill between slices" src="../img/fillbetweenslice1.png" /></p>
<p><em>Process of <code>Fill between slices</code>. Reference serial images are 5x5x10 µm/voxel, 1220x875 pixels, 820 images of mouse mid gut on E12 (Not chick heart). <code>Draw</code> in the RED plane for whole mid gut every 5 images, and in the YELLOW plane for in a loop every 10 images.</em></p>
<ol>
<li><span style="color:#444C99;"><code>Initialize</code> すこし待つ</span></li>
<li><span style="color:#444C99;"><code>Show 3D</code> ONで青画面に表示させる。スライドバーで描いたセグメントと補完したセグメントの透明度を調整し見やすくする</span></li>
<li><span style="color:#444C99;">がたつきがひどければ、<code>Paint</code>と<code>Erase</code>で修正する。<code>Auto update</code>にチェックをいれて おくと、修正中に、<code>Fill between slices</code>の像に反映されていく</span></li>
<li><span style="color:#444C99;"><code>Apply</code>で完了。ボタン<code>Undo</code>で元に戻せる。全体を塗れたと思ってから行う。多少の修正は、<code>Erase</code>を使ったりして、あとでもできる。多少のガタツキは次の<code>Smooth</code>で直せる</span></li>
<li><span style="color:#444C99;">Apply後に修正が必要なら、<code>Erase</code>などで修正する。変な突起ができたり、近接構造が融合したりして、修正したことがある</span></li>
</ol>
</li>
<li>
<p><span style="color:#444C99;">ボタン<code>Add segment</code>で、<code>Segment_2</code>もつくる。「Vein」と名称をつけて、<code>Paint</code>で肺動脈を塗った。同様にFill between slicesも行った</span></p>
</li>
<li>
<p><span style="color:#444C99;"><code>Smooth</code>で滑らかにする（モジュール<code>Segment Editor</code>）</span></p>
<p><img alt="Smooth comparison" src="../img/smooth.png" /></p>
<p><em><span style="color:#444C99;">スムージングの方法と設定の比較。なお、ボクセルサイズは本来の5x5x10μm/voxelではなく、ボリュームモジュールで5x5x10mm/voxel（マイクロメートルではなくミリメートル）に設定されている。MacBookPro16 M1 maxを使用。黄色の時間は、<code>Apply</code>をクリックした後の処理にかかった時間を示す。</span></em></p>
<ol>
<li><span style="color:#444C99;">Smoothing Method: <code>Joint smoothing</code>を好んで使用している。（Joint smoothingは、表示中の複数のSegmentを処理し、処理時間が短い。MedianやGaussianは、選択中のセグメントだけを処理し、処理時間が長い。MedianやGaussianの設定では、長さを入力する。Medianでは、pixelsが表示される。1x1x1だと変化なし、3x3x1だとトゲくらいならなくなる。7x7x7, 11x11x7などでようやくJoint smoothing_0.5相当になるが、処理時間が非常に長くなる）</span></li>
<li><span style="color:#444C99;"><code>Joint smoothing</code>の設定では、数値を入力する。まずはデフォルトの0.5を試す</span></li>
<li><span style="color:#444C99;"><code>Apply</code>で完了</span></li>
<li><span style="color:#444C99;">満足できなければ、ボタン<code>Undo</code>と、設定値の変更（0.3-1.0）、<code>Apply</code>を繰り返す</span></li>
<li><span style="color:#444C99;">細かい修正が必要なら、<code>Erase</code>などを使用する。近接構造が融合してしまい、Eraseで修正した例を下に示す</span></li>
</ol>
<p><img alt="Erase" src="../img/erase.png" /></p>
<p><em><span style="color:#444C99;">赤画面において、不必要につながった場所をEraseで消した</span></em></p>
</li>
<li>
<p><span style="color:#444C99;">Volume Renderingとセグメントを重ねて表示し確認できる。モジュール<code>Volume rendering</code>、マーク<code>Eye</code>で、青画面への表示をON。動作が鈍くなるのでOFFにして作業に戻る</span></p>
</li>
<li><span style="color:#444C99;">アイコン<code>Camera</code>（Capture Screenshot）で、静止画に描き出せる</span></li>
<li><span style="color:#444C99;">Saveのとき、一括ファイルか、Segmentationのみの個別ファイルかを選べる。別のプロジェクトへ移入させたいときは個別ファイルにする</span></li>
</ol>
<hr />
<h4 id="obtaining-volume-values-of-segments">Obtaining volume values of segments/セグメントの体積を数値として取得する</h4>
<ul>
<li>
<p>Module <code>segmentation</code> &gt; <code>Quantification</code> &gt; <code>Segment statistics</code>. After choosing this module, the display mode will be changed automatically to show "Table". Values can be saved as CSV file, which can be exported into Excel.</p>
</li>
<li>
<p>モジュール<code>segmentation</code>&gt;<code>Quantification</code>&gt;<code>Segment statistics</code>。このモジュールをクリックすると、ウィンドウデザインが変わって、数値一覧がでる。CSVにでも書き出せば、Excelなどで使える。</p>
</li>
</ul>
<hr />
<h4 id="tips_2">Tips/工夫やヒント</h4>
<ul>
<li>
<p><strong>First attempt is not always the best:</strong> I perform a rough segmentation once to get an idea of the tools to use, the spacing of the paints, and imagine the finished segment. Then, I try again and again.
    <span style="color:#444C99;"><br>
    <strong>最初はうまく行かないもの：</strong>まず一度、セグメンテーションをおおざっぱにやってみて、使うツール、塗る間隔、完成形の見通しをたてます。2回目以降を本番としています。
    </span></p>
</li>
<li>
<p><strong>Choose the tool appropriately:</strong> If the color and shape are clear, you can use <code>Level tracing</code>, which selects a color similar to the color where the mouse pointer is located. <code>mouse over</code>+<code>Left click</code>. However, while it may be good for CT images, it may not work well for CoMBI images. If the colors are faint and the borders are unclear, use <code>Paint</code>, <code>Draw</code>, or <code>Erase</code>. Else use iLastik.
    <span style="color:#444C99;"><br>
    <strong>適切にツールを選ぶ：</strong>色と形がはっきりしていれば、<code>Level tracing</code>が使えます。マウスポインターがある色と類似の色を島状に選択してくれます。<code>mouse over</code>+<code>Left click</code>。CT画像にはいいかもしれませんが、CoMBIの画像ではあまり出番はないかもしれません。もっとも、対象物によります。色が淡く、境界がぼんやりしている場合は、<code>Paint</code>, <code>Draw</code>, <code>Erase</code>を使います。
    </span></p>
</li>
<li>
<p><strong>Evenly spaced images to be painted:</strong> Use the arrow keys on the keyboard to flip the image. Equally spaced images are easier to correct later. For example, every 2, 5, or 10 images.
    <span style="color:#444C99;"><br>
    <strong>塗る画像は等間隔：</strong>画像めくりはキーボードの矢印キー。等間隔のほうが、のちの修正がラク。例えば、2, 5, 10枚ごとにしています。
    </span></p>
</li>
<li>
<p><strong>Segmentation fails when angled in MPR (Multiplanar Reconstruction): </strong>
In the reconstructed planes (red, yellow, and green screens), when I angled and then segmented, the segmentation was broken up and I could not get a proper Segment, Fill between, or Smooth. You may have a situation where you want to adjust the angle of a sample to make it a transverse or sagittal section because it was embedded at an angle, but you should do the segmentation first and leave the angle adjustment for later.
    <span style="color:#444C99;"><br>
    <strong>MPR（多平面再構築）で角度をつけると、Segmentationできない：</strong>多平面（赤画面、黄画面、緑画面）において、角度をつけてからSegmentationしたら、とびとびになって、まともなSegment, Fill between, Smoothになりません。「サンプルちょっと斜めで包埋されていたから、角度を調節して、きっちりと横断面、矢状断面にしたい」ということがあるかもしれませんが、Segmentation作業を先にして、角度調整はあとまわしにしてください。
    </span></p>
</li>
<li>
<p><strong>Complex shape:</strong> The midgut is squishy, curved, and has multiple loops. Option 1: Make separate segments for each loop and fuse them together later. Option 2: If you want to do a single segment from the beginning, paint multiple loops on the same image. A bad approach is to "paint one loop in this image and another loop in another image," in which case the filling will break down.
    <span style="color:#444C99;"><br>
    <strong>複雑な形状：</strong>中腸は、グニャグニャと曲がって、複数のループがある。案1：個々のループで別のセグメントにして後で融合する。案2：はじめから単一セグメントでやりたい場合、同じ画像上で、複数ループを塗ること。ダメなのは「こっちのループはこの画像で塗って、あっちのループはあっちの画像で塗る」ことで、その場合、補完が破綻する（下図）</span></p>
<p><img alt="Fill between slices" src="../img/fillbetweenslice2.png" /></p>
<p><em>Four parts of mid gut are shown. [Upper panel] <code>Draw</code> every 5 images for all 4 gut and preview <code>Fill between slices</code>.  [Lower panel] When <code>Draw</code> additional region only in the left-most gut (stars), <code>Fill between slices</code> was broken.</em></p>
</li>
<li>
<p><strong>Create a segment within a segment:</strong> The modules <code>Segmentaion</code> and <code>Edit segmentaion</code> can be seen as <code>Folders</code> and <code>Files</code> (basic computer operations) and <code>Groups</code> and <code>Objects</code> (Illustrator). For example, you want to create one segment for the whole heart and four segments for each chambers. For the whole heart segment, Module <code>Segmentation</code> &gt; <code>Active segmentation: Create new...</code> &gt; <code>Add</code>(whole heart), and <code>Edit selected</code>. For four chambers, Module <code>Segmentation</code> &gt; <code>Active segmentation: Create new...</code>, &gt; <code>Add</code> four segments, and edit them. 
    <span style="color:#444C99;"><br>
    <strong>セグメントの中にセグメントを作りたい：</strong>「モジュール<code>Segmentaion</code>と、モジュール<code>Edit segmentaion</code>」は、「フォルダとファイル（パソコンの基本操作）」、「グループとオブジェクト（illustrator）」と捉えることができます。例えば、心臓全体のセグメント１つと、各心室のセグメントを４つ作りたいときがあるとします。心臓全体のセグメントは、モジュール<code>Segmentation</code>で、Active segmentation: <code>Create new...</code> をつくって、その中に心臓全体セグメントを<code>Add</code>して、<code>Edit selected</code>(モジュール<code>Edit segment</code>)します。各心室用には、モジュール<code>Segmentation</code>で、Active segmentation: <code>Create new...</code>で、また別のSegmentationをつくり、その中に、４つ心室用Segmentを<code>Add</code>し、編集します。
    </span></p>
</li>
<li>
<p><strong>Balance between the time required for segmentation and the quality of the segments:</strong> Drawing in multiple planes requires a lot of time but is worth of effort since it improves the quality of segments. Some object shows its border clearly in one plane but not clear in other plane. I often draw in one plane (red screen) exactly, and draw in the another plane as a supplementary.
    <span style="color:#444C99;"><br>
    <strong>作業の所要時間とセグメントの綺麗さのバランス：</strong>1面（赤画面）目では、対象物全体を等間隔できっちりDrawし、2面目は補助的にDrawする。1面（赤画面）だけよりは、2面（緑か、黄）できっちり塗ったほうが、セグメントの仕上がりが良いが、時間がかかる。境界があいまいでも、別の面でははっきり見える場合が多いので、多面塗りには価値がある。境界があいまいで自信がないとき、1面目では、控えめ・小さめに塗り、別の面で自信を持って塗るとよい
    </span></p>
</li>
<li>
<p><strong>Heavy task:</strong> The size and number of reference serial images (called as "Master Volume" in the module <code>Segmentation</code>) affect the working efficiency. The maximum size for color JPEGs seemed to be about 500x500x500 (Table 1), though, of course, this depends on the specifications of the computer. I often use the reduced series (500 x 500 x 500) for segmentation work and later transfer only the segmentation files to the high quality series (1000 x 1000 x 1000 for VR).<br>
Reducing the number of consecutive images will make the operation faster, but the segments will be rougher, since the result of <code>Fill between slice</code> will be worse. XY:Z = 1:1, 1:2, or 1:4 is probably the best, while 1:10 (e.g., 5µm x 5µm x 50µm, 1000 x 1000 x 200 sheets) produces a clear staircase and is completely useless (Table 2).Otherwise, the high quality 1:2 (5µm x 5µm x 10µm, 1000 x 1000 x 1000) images would be too heavy. Choosing the appropriate data size is always difficult.<br>
As the number of Segmentations increases over 10 to 20, the computer performs slower.<br>
As the size of Segmentation increases, the computer performs slower. For example, when I compared the segment of a single eyeball with that of a whole body in a dataset of mouse embryo, PC can draw eyeball easily, but it almost froze when drawing whole body (Table 2,3).<br>
I am using MacBookPro15 (2018-2021, i9, 4GB-HBM2, 32GB) and from 2022, MacBookPro16 (2021, M1 max, 64GB unified memory). Even with a better machine, larger segments or more segments make operation slower. Both can process 500 x 500 x 1000 images（0.8 GB) stably. M1 max seems to process 1000 x 1000 x 1000 images (3.3 GB), exept for larger segments (Table 3).
    <span style="color:#444C99;"><br>
    <strong>作業が重い：</strong>参照する連続画像（モジュール<code>Segmentation</code>では<code>Master Volume</code>と表記）の大きさと枚数が、動作に影響します。カラーJPEGで500x500x500枚程度が限度のようでした（Table.1）。もっとも、パソコンのスペックにもよるとは思います。Segmentation作業用の3D slicerファイルは、縮小/減数シリーズ（500 x 500 x 500）をつかって、もし高画質シリーズ（1000 x 1000 x 1000）に重ねる必要があれば、あとでセグメンテーションファイルだけを移入するのがいいと思います。<br>
    連続画像の枚数を減らすと軽くなりますが、セグメントは荒くなります。<code>Fill between slice</code>の結果が悪くなるためです。XY:Z＝1:1, 1:2, 1:4くらいが限度でしょう。1:10 (例、5µm x 5µm x 50µm, 1000 x 1000 x 200枚)ではくっきりとした階段ができてしまい、さっぱりダメでした（Table.2）。そうかといって、高画質の1:2 (5µm x 5µm x 10µm, 1000 x 1000 x 1000枚)にすると重くなるし、もどかしいところです。<br>
    Segmentationの数が10個〜20個と多くなると、パソコンの動作が鈍くなっていきます。<br>
    Segmentationの大きさが大きくなると、動作が鈍くなります。例えば、マウス胚で眼球一つのセグメントと、胚子全体のセグメントを比較すると、眼球は余裕なのに、胚全体はフリーズしそうになりました（Table.2,3）。<br>
    2018-2021年は、MacBookPro15（2018, i9, 4GB-HBM2, 32GB）、2022年からは、MacBookPro16（2021, M1 max, 64GB unified    memory）を使っています。マシンが良くなっても、Segmentが大きくなったり、Segmentの個数が増えれば、動作が重くなります。500 x 500 x 1000枚（0.8 GB）なら、安定して作業できました。M1 maxは、1000 x 1000 x 1000枚（3.3 GB）でも扱えそうでしたが、順調なのは最初だけで、大きなSegmentになっていくと、かなり鈍くなり実用的ではありませんでした（Table.3）。<br></p>
<p>Table 1: Datasets for testing segmentation performance. Specimen: whole embryo of mouse on E12, computer: MacBookPro16 M1 max. </p>
<table>
<thead>
<tr>
<th>Datasets&nbsp;</th>
<th>1220 x 875 pixels,<br>820 images</th>
<th>610 x 438 pixels,<br>820 images</th>
<th>1220 x 875 pixels,<br>164 images</th>
<th>610 x 438 pixels,<br>164 images</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td>RGB, 8bit</td>
<td>RGB, 8bit</td>
<td>RGB, 8bit</td>
<td>RGB, 8bit</td>
</tr>
<tr>
<td>Folder<br>original JPEG images</td>
<td>64 MB</td>
<td>43 MB</td>
<td>14 MB</td>
<td>9 MB</td>
</tr>
<tr>
<td>3D slicer format<br>.mrb</td>
<td>685 MB</td>
<td>303 MB</td>
<td>137 MB</td>
<td>43 MB</td>
</tr>
<tr>
<td>Size<br>as TIFF</td>
<td>3.3 GB</td>
<td>0.84 GB</td>
<td>0.66 GB</td>
<td>0.165 GB</td>
</tr>
<tr>
<td>XYZ size (voxel)</td>
<td>5 x 5 x 10 µm</td>
<td>10 x 10 x 10 µm</td>
<td>5 x 5 x 50 µm</td>
<td>10 x 10 x 50 µm</td>
</tr>
</tbody>
</table>
<p>Table 2: Segmentation of small object; an eye ball.</p>
<table>
<thead>
<tr>
<th>Process&nbsp;</th>
<th>1220 x 875 pixels,<br>820 images</th>
<th>610 x 438 pixels,<br>820 images</th>
<th>1220 x 875 pixels,<br>164 images</th>
<th>610 x 438 pixels,<br>164 images</th>
</tr>
</thead>
<tbody>
<tr>
<td>Draw<br>Show 3D ON</td>
<td>A slight delay <br>after <code>Enter</code></td>
<td>No delay</td>
<td>No delay</td>
<td>No delay</td>
</tr>
<tr>
<td>Fill between slices<br>initialize</td>
<td>No delay</td>
<td>No delay</td>
<td>No delay</td>
<td>No delay</td>
</tr>
<tr>
<td>Fill between slices<br>quality</td>
<td>Good, <br>filled smoothly</td>
<td>Good, <br>filled smoothly</td>
<td>Bad, <br>filled like steps.</td>
<td>Bad, <br>filled like steps.</td>
</tr>
</tbody>
</table>
<p>Table 3: Segmentation of large object; whole body of mouse E12.</p>
<table>
<thead>
<tr>
<th>Process&nbsp;</th>
<th>1220 x 875 pixels,<br>820 images</th>
<th>610 x 438 pixels,<br>820 images</th>
<th>1220 x 875 pixels,<br>164 images</th>
<th>610 x 438 pixels,<br>164 images</th>
</tr>
</thead>
<tbody>
<tr>
<td>Draw<br>Show 3D ON</td>
<td>(not tested)</td>
<td>(not tested)</td>
<td>10 to 20 sec delay<br>after <code>Enter</code></td>
<td>5 to 10 sec delay<br>after <code>Enter</code></td>
</tr>
<tr>
<td>Fill between slices<br>Initialize</td>
<td>(not tested)</td>
<td>(not tested)</td>
<td>1 min 25 sec delay, <br>after <code>Enter</code></td>
<td>18 sec delay, <br>after <code>Enter</code></td>
</tr>
<tr>
<td>Fill between slices<br>Show 3D</td>
<td>(not tested)</td>
<td>(not tested)</td>
<td>immediately</td>
<td>immediately</td>
</tr>
<tr>
<td>Fill between slices<br>Apply</td>
<td>(not tested)</td>
<td>(not tested)</td>
<td>10 sec delay<br>after <code>Enter</code></td>
<td>2 sec delay<br>after <code>Enter</code></td>
</tr>
<tr>
<td>Smooth<br>Joint smoothing</td>
<td>(not tested)</td>
<td>(not tested)</td>
<td>55 sec delay<br>after <code>Enter</code></td>
<td>16 sec delay<br>after <code>Enter</code></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>Correct Segmentation:</strong></p>
<ol>
<li>At first, draw in the images with widely intervals.</li>
<li>Try <code>Fill between slices</code> &gt; <code>Initalize</code>. If minor discontinuities are found, carefully correct the painted areas, using <code>Paint</code>, <code>Draw</code>, or <code>Erase</code>. </li>
<li>If it does not be corrected, increase the images to be painted, till <code>Fill between slices</code> &gt; <code>Apply</code> shows continuos segment.</li>
<li>Try <code>Smoothing</code> &gt; <code>Joint Smoothing</code> &gt; <code>0.5</code>. If there still are some roughness, correct again using  <code>Paint</code>, <code>Draw</code>, or <code>Erase</code>.</li>
<li>Repeat <code>Smoothing</code> and correction till you satisfy.</li>
</ol>
<p><strong><span style="color:#444C99;">Segmentationの結果が粗い：</span></strong>
<br></p>
<ol>
<li><span style="color:#444C99;">最初は、とびとびに塗っていき、</span></li>
<li><span style="color:#444C99;">まずは<code>Fill between slices</code> &gt; <code>Initalize</code>の結果を見ます。軽微な不連続がみつかったら、すでに塗った場所を丁寧に修正します（<code>Paint</code>, <code>Draw</code>, <code>Erase</code>など）。塗りの修正でも治らない場合は、塗る枚数を増やします。連続性的にFillされたら、<code>Fill between slices</code> &gt; <code>Apply</code>します。</span></li>
<li><span style="color:#444C99;">次に、<code>Smoothing</code>をつかってみます。<code>Joint Smoothing</code>, <code>0.5</code>を試します。修正したい窪みや突起があれば、丁寧に修正します（<code>Paint</code>, <code>Draw</code>, <code>Erase</code>など）。</span></li>
<li><span style="color:#444C99;">繰り返し、<code>Smoothing</code>と修正をします。満足できるまで</span></li>
</ol>
</li>
<li>
<p><strong>Freeze keyboard arrows:</strong> Once zoom in and out, it may work. Sometimes it will work after a while.
    <span style="color:#444C99;"><br>
    <strong>キーボードの矢印キーが効かない：</strong>いちどズームイン・ズームアウトすると、効くようになることがあります。そのうちに効くようになることもあります</span></p>
</li>
<li>
<p><strong>Freeze Draw and Paint:</strong> Sometimes after drawing with <code>Draw</code>, pressing <code>Retrun</code> does not respond or <code>Paint</code> becomes unresponsive. Zoom in and out once, or switch the tool to the <code>None</code> arrow and then select <code>Draw</code> again.  If it still doesn't work, restart the application.
    <span style="color:#444C99;"><br>
    <strong>DrawやPaintが効かない：</strong><code>Draw</code>で描いたあと<code>Retrun</code>を押しても反応しないときや、Paintが無反応になるときがあります。いちどズームイン・ズームアウトする。もしくは、ツールを矢印<code>None</code>に一旦切り替えてから、改めて<code>Draw</code>を選ぶと、効くようになることがあります。どうしても効かないときは、アプリを再起動します</span></p>
</li>
<li>
<p><strong>Display position shifts with iPad, Side car, Apple pen:</strong> Zoom in and out (pinch in and pinch out) to get back to the original position you want. If there are many input devices (Apple Pen, mouse, trackpad, keyboard), and you touch any of them, display positoin may shift. ApplePencil is not good for browsing. It jumps slices (images).
    <span style="color:#444C99;"><br>
    <strong>iPad, Side car, Apple penで表示位置が飛ぶ：</strong>ズームイン・ズームアウト（ピンチイン・ピンチアウト）して、元の見たい位置に戻します。入力デバイスが多く（Apple Pen、マウス、トラックパッド、キーボード）どこかに触れてしまうとずれる時がありました。また、スライスめくりのバーをApplePenで操作すると位置飛びが起こりますが、マウスで操作すると飛ばないようです。</span></p>
</li>
<li>
<p><strong>Can't display planes:</strong> Nothing happens when I turn on or off the <code>Eye mark</code>, or a black image is displayed. Once, in the module <code>Data</code>, discard the serial images and reload the serial images again. Use <code>Data Load</code> or <code>Drag &amp; Drop</code>. The first time I saw this symptom was when I tried to display volume rendering, segmentation and cross section at the same time. Quite heavy duty!
    <span style="color:#444C99;"><br>
    <strong>青画面に断面像を表示できない：</strong>眼のマーク<code>Eye mark</code>でON,OFFしてもなにも起こらなかったり、真っ黒な画像が表示されたりすることがありました。いったん、モジュール<code>Data</code>で、連続画像を捨てて、改めて連続画像を読み込みます。<code>Data Load</code>または、<code>Drag &amp; Drop</code>。この症状が見られたのは、Volume renderingとSegmentationと断面を同時に表示をさせようとしたときでした。かなり重い作業です</span></p>
</li>
<li>
<p><strong>Forget to set up units！</strong> I forgot to change the units to µm and realized after working on segmentation that I had left it in mm. In such a case, you can correct it later with the module <code>Transform</code>. For example, if you want 60x60x40µm instead of 60x60x80mm, enter 0.06, 0.06, 0.08 diagonally in the matrix display.
    <span style="color:#444C99;"><br>
    <strong>単位設定を忘れてた！：</strong>単位をµmに変えるのを忘れ、mmのままでSegmentation作業を進めてから気づいたことがありました。そんなとき、あとでモジュール<code>Transform</code>で修正できます。例として、60x60x80mmではなく、60x60x40µmにしたいとき、行列表示に、0.06, 0.06, 0.08と斜めに入力します。</span></p>
</li>
</ul>
<hr />
<h3 id="3d-printer3d-in-practicing">3D printer/3Dプリンタ (in practicing)</h3>
<p>The module <code>Segmentations</code> has 2 export function. One can export STL file for 3D printing. Another can export segments to the module <code>Model</code> within the 3D slicer app. Hum...it is complicated.</p>
<ul>
<li>
<p><code>Export to files</code>, maybe for 3D printer</p>
<ol>
<li>Set <code>Destination folder</code></li>
<li><code>Visble segments only;</code>, or as you like.</li>
<li><code>Reference vol:</code> I don't know, try default. </li>
<li><code>File format:</code> STL</li>
<li><code>Scale size:</code> (I don't know which unit is better for CoMBI dataset. Real size(µm) or printer size (mm))</li>
<li><code>Export</code></li>
</ol>
</li>
<li>
<p><code>Export/Import models and labelmaps</code> into Module <code>Model</code> within 3D slicer app.</p>
<ol>
<li>Operation: <code>Export</code>, </li>
<li>Output type: Models, Output node: </li>
<li>Export models to new folder (default, red arrow for restore to default)</li>
<li>Advanced (default)</li>
<li>Button <code>Export</code></li>
<li>Go to Module <code>Model</code>, and check segments exported. Go to Module <code>Data</code>, confirm additional data created.</li>
<li>In the Module <code>Model</code>, Coloring (rainbow color!) of segment and slice maybe possible. Is this polygon?, much lighter than original segments.</li>
</ol>
</li>
</ul>
<p><span style="color:#444C99;"><br>
モジュール<code>Segmentations</code>から、3Dプリンタ用に、SegmentをSTLへExportする。モジュール<code>Segmentations</code>には、別のExportもあって、3D slicer内のモジュール<code>Model</code>へ、SegmentをExportする。外部と内部、ややこしい。</span></p>
<ul>
<li>
<p><span style="color:#444C99;">3Dプリンタ用のデータを出力する。<code>Export to files</code> ファイルとして、外部にExportされる。きっと3Dプリンタ用。</span></p>
<ol>
<li><span style="color:#444C99;">Destination folderをきめる。保存先。</span></li>
<li><span style="color:#444C99;">Visble segments only; このみでチェック。</span></li>
<li><span style="color:#444C99;">Reference vol: わからないがデフォルト、連続画像セットの名称が記されている。</span></li>
<li><span style="color:#444C99;">File format: STL</span></li>
<li><span style="color:#444C99;">Scale size: （CoMBIのデータなら、µmが多いけど...まだ試していない）</span></li>
<li><span style="color:#444C99;">ボタン<code>Export</code></span></li>
</ol>
</li>
<li>
<p>3D slicer内のモジュール<code>Model</code>へ出力する。<code>Export/Import models and labelmaps</code></span></p>
<ol>
<li><span style="color:#444C99;">Operation: <code>Export</code>, </span></li>
<li><span style="color:#444C99;">Output type: Models, Output node: </span></li>
<li><span style="color:#444C99;">Export models to new folder (デフォルト、赤い矢印ボタンでデフォルトに戻る)</span></li>
<li><span style="color:#444C99;">Advancedはいじらないで。</span></li>
<li><span style="color:#444C99;">ボタン<code>Export</code></span></li>
<li><span style="color:#444C99;">モジュール<code>Model</code>にSegmentがうつった。</span></li>
<li><span style="color:#444C99;">モジュール<code>Data</code>にデータが増えたことを確認できる。3D slicer内でのExport。きっと、いろんないろつけ。Segmentの表面をレインボーカラーなどカラフルにしたり、各スライスでの色を違えたりできる。ポリゴンか？軽いのか。</span></li>
</ol>
</li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © 2021 Yuki Tajika, CC BY 4.0
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6e54b5cd.min.js"></script>
      
    
  </body>
</html>