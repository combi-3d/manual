
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Manual of CoMBI">
      
      
        <meta name="author" content="Tajika Y.">
      
      
      <link rel="icon" href="../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.9">
    
    
      
        <title>Resizing and reducing/画像の縮小と軽量化 - Manual of CoMBI</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.120efc48.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#resizing-and-reducing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Manual of CoMBI" class="md-header__button md-logo" aria-label="Manual of CoMBI" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Manual of CoMBI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Resizing and reducing/画像の縮小と軽量化
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Manual of CoMBI" class="md-nav__button md-logo" aria-label="Manual of CoMBI" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    Manual of CoMBI
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        Top page
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Installation/導入
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation/導入" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Installation/導入
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/system/index.html" class="md-nav__link">
        System Overview/概要
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/camera/index.html" class="md-nav__link">
        Imaging devices/カメラなど
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/selfmade/index.html" class="md-nav__link">
        Self-made devices/自作装置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/computer/index.html" class="md-nav__link">
        Computer and storage/コンピュータとストレージ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/application/index.html" class="md-nav__link">
        Applications/アプリケーション
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Instruction/操作
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Instruction/操作" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Instruction/操作
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/frozenblock/index.html" class="md-nav__link">
        Frozen Block
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/paraffinblock/index.html" class="md-nav__link">
        Paraffin Block
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/camerasettings/index.html" class="md-nav__link">
        Camera Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/tethering/index.html" class="md-nav__link">
        Tethering (optional)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-u/index.html" class="md-nav__link">
        CoMBI-U (Universal)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-c/index.html" class="md-nav__link">
        CoMBI-C (Cryostat)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-s/index.html" class="md-nav__link">
        CoMBI-S (Sliding, motorized)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-s-m/index.html" class="md-nav__link">
        CoMBI-S (Sliding, manual)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-r/index.html" class="md-nav__link">
        CoMBI-R (Rotary, manual)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Image Processing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image Processing" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Image Processing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/index.html" class="md-nav__link">
        Overview/画像処理の概要
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rawjpeg/index.html" class="md-nav__link">
        RAW to JPEG conversion/RAW現像
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Resizing and Reducing/画像の縮小
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../registration/index.html" class="md-nav__link">
        Image Registration/ズレ補正
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../3dslicer/index.html" class="md-nav__link">
        3D Reconstruction, 3D slicer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../icy/index.html" class="md-nav__link">
        3D Reconstruction, Icy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../horos/index.html" class="md-nav__link">
        3D Reconstruction, Horos/OsiriX
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../correlation/index.html" class="md-nav__link">
        Correlation of 2D and 3D images/3D像に切片位置を示す
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../EDF/index.html" class="md-nav__link">
        Extended Depth of Field/深度合成
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ilastik/index.html" class="md-nav__link">
        Segmentation by ilastik/セグメンテーション
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/gallery/index.html" class="md-nav__link">
        Gallery/作品集
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../publication/publication/index.html" class="md-nav__link">
        Publications/論文
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" data-md-state="indeterminate" type="checkbox" id="__nav_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Electronics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Electronics" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Electronics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/ATmega328P/index.html" class="md-nav__link">
        ATmega328P standalone/単体利用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/terminal/index.html" class="md-nav__link">
        Crimped terminal/圧着端子
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/vender/index.html" class="md-nav__link">
        Venders/パーツの入手先
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/mkdocs/index.html" class="md-nav__link">
        Mkdocs-material/HPづくり
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    アプリケーション
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    縮小の計画
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_photoshop-action-batch" class="md-nav__link">
    縮小_Photoshop, Action, Batch処理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_photoshop-droplet" class="md-nav__link">
    縮小_Photoshop, Droplet機能
  </a>
  
    <nav class="md-nav" aria-label="縮小_Photoshop, Droplet機能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    ヒント
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_imagejfiji" class="md-nav__link">
    縮小_ImageJ/FIJI
  </a>
  
    <nav class="md-nav" aria-label="縮小_ImageJ/FIJI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ijm" class="md-nav__link">
    マクロファイル（拡張子ijm）の例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    ヒント
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_" class="md-nav__link">
    軽量化_枚数を減らす
  </a>
  
    <nav class="md-nav" aria-label="軽量化_枚数を減らす">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mac" class="md-nav__link">
    Macの場合：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    Windowsの場合：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    連続画像のファイル名一括変換
  </a>
  
    <nav class="md-nav" aria-label="連続画像のファイル名一括変換">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-os" class="md-nav__link">
    Windows OSで一括変換
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mac-os" class="md-nav__link">
    Mac OSで一括変換
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adobe-bridge" class="md-nav__link">
    Adobe Bridge（有料アプリ）で一括変換
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="resizing-and-reducing">Resizing and reducing/画像の縮小と軽量化</h1>
<p>(This page is still in Japanease only.)</p>
<h2 id="_1">アプリケーション</h2>
<p>下記のどれか使います。</p>
<ul>
<li>Adobe Photoshop, Action and Batch. </li>
<li>ImageJ/FIJI, Macro</li>
</ul>
<p>Photoshopのアクション・自動処理・バッチでは、複雑な操作も記録できます。ImageJ/FIJIでもMacroを使ってできますが、記録できることがPhotoshopよりも少ない感じです。もしかしたら、熟達者ならPhotoshop相当に複雑に記録できるのかもしれませんが、よくわかりませんでした。MacのM1 maxは、Photoshop(v23.2.1 M1ネイティブ、macOS12.2.1、MBP16-2021、2022-3-14メモ）のバッチでマルチスレッドに対応していません。処理が何倍も遅くなるので、現状では、M1シリーズでは、FIJIをおすすめします。</p>
<h2 id="_2">縮小の計画</h2>
<p>縮小の目的は、ズレ補正用の軽い連続画像をつくること、および、3D用のグレースケール画像も作ることです。ついでにピクセルサイズをキリの良い数値にして整理整頓、作業しやすくしています。</p>
<p>一例、「Nikon D810でおおよそ1倍、フルサイズ撮影した。スケールを確認すると4.88µm/pixelだった」</p>
<table>
<thead>
<tr>
<th></th>
<th>µm/pixel</th>
<th>pixels</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>元画像</td>
<td>4.88</td>
<td>7360×4912</td>
<td>color</td>
</tr>
<tr>
<td>縮小1</td>
<td>5</td>
<td>7183x4794</td>
<td>color, gray</td>
</tr>
<tr>
<td>縮小2</td>
<td>10</td>
<td>3592x2397</td>
<td>color, gray</td>
</tr>
<tr>
<td>縮小3</td>
<td>20</td>
<td>1795x1199</td>
<td>color, gray</td>
</tr>
<tr>
<td>縮小4</td>
<td>40</td>
<td>898x599</td>
<td>color, gray</td>
</tr>
</tbody>
</table>
<p>この例では、4通りの縮小連続画像をつくることになります。ズレ補正で扱える1000x1000以下の軽いシリーズができるまで、縮小します。実際は、縮小の前にクロップすることが多いので、これらより小さな画像を扱っています。例のように縮小が4通りにもなることは稀で、通常は2通りか3通りです。クロップでは、標本ブロックの外周が残るようにします。</p>
<p>それぞれの縮小連続画像で、カラーもグレースケールも作ることが多いです。利用目的としては、カラーシリーズは、MPRや、Segmentationに使い、グレースケールは、主にVolume Renderingに使います。グレースケールは軽いのが理由で、重い作業（ImageStabilizerやSegmentation）に使うこともあります。</p>
<p>Photoshop 2通り、ImageJ 1通りの、計3通り記します。どれかで行います。WindowsOSの拡張機能や、macOSのAutomator.appを利用した方法もありますが、圧縮率や補完法の選択ができないようで、検証をすすめていません。</p>
<h2 id="_photoshop-action-batch">縮小_Photoshop, Action, Batch処理</h2>
<p>Photoshopの準備として、縮小時のアルゴリズムを固定しておくと安心です。<code>Preference</code>&gt;<code>General</code>&gt;<code>Image Interporation</code>&gt;<code>Bicubic sharper(best for reduction)</code>にしておけます（反映されない？かもしれないので、実行前に要確認）。また、ホーム画面を開かないようにしたほうが<code>Action</code>の操作で都合が良いです。<code>Preference</code>&gt;<code>General</code>&gt; Uncheck <code>Auto show the Home Screen</code>。チェックを外しておきます。デフォルトではホームページが開くようになっており、Actionに<code>Close window</code>を記録すると、Actionを含めたすべてのウィンドウが表示されなくなってしまい、不便です。ActionのBatchにおいて、MacBookPro-2021 M1 maxは、MacBookPro-2018 i9よりも、処理が倍ほど遅いです。CPU usageをながめると、どうやらマルチタスクにならないようです。対策は分からず、PhotoshopのGPU処理をON/OFFしても変わりませんでした。</p>
<ol>
<li>スケール画像で、ピクセルサイズを計算する。Refering to the scale image taken beforehand, caliculate the pixel size of the original blockface image in micrometer/pixel. </li>
<li>縮小させる計画をたて、1のピクセルサイズを参考に縮小後の画像サイズを計算しておく。ピクセルサイズが、きりの良い数字になるように縮小している（のちの3Dイメージングに便利）。最小は一片500pixel程度になるように計画する（のちのズレ補正では、軽い画像シリーズから試す）。のちのズレ補正に Cariculate the reduced image size to make 5, 10, 20, or 40 µm/pixel image series.</li>
<li>新規フォルダを必要数作成する。縮小した画像シリーズを保存するため。</li>
<li>
<p><code>Action</code>に記録する。作業ウィンドウが出ていなければ、<code>Window</code>&gt;<code>action</code>で表示させる。新規アクションを<code>白い紙のマーク</code>で新規アクションを作成する。名称はデフォルトでも変更しても、あとで利用するときに分かれば良い。記録が始まっていれば、<code>赤い丸</code>が表示されている。記録できるのは、画像縮小1種目、別名保存、グレースケール、別名保存、もとに戻す、画像縮小2種目、閉じるなど、さまざま。記録を停止するときは、<code>四角ボタン</code>。</p>
<ol>
<li>画像縮小1 <code>Image</code>&gt;<code>Image Size...</code> Resamplingモードは、<code>Preserve Details 2.0</code>または<code>Bicubic Sharper (reduction)</code>を選ぶ。</li>
</ol>
<p><img alt="segmetation" src="../img/resample_menu_600.png" /></p>
<ol>
<li>別名保存（カラー画像、JPEGなら圧縮率<code>10</code>。TIFFでもよいがデータ量が多いのでディスクに十分な空きを。）</li>
<li>グレースケールへ変換。<code>Image</code>&gt;<code>Mode</code>&gt;<code>Grayscale</code></li>
<li>別名保存（グレースケール画像）</li>
<li>画像縮小2（縮小1と同様に、Image Size、別名保存、Grayscale、別名保存）</li>
<li>アクションを停止する<code>四角ボタン</code>。</li>
</ol>
</li>
<li>
<p>いざ連続画像を一括して縮小。<code>File</code>&gt;<code>Automate</code>&gt;<code>Batch...</code> 記録したアクションと、実行させたい連続画像入りフォルダを指定し、実行する。</p>
</li>
</ol>
<hr />
<h2 id="_photoshop-droplet">縮小_Photoshop, Droplet機能</h2>
<p>Batchとは別に、Dropletというやり方もあります。記録したアクションをドロップレットファイルとして保存して、画像のサムネイルにドラッグします。結果は同じです。Dropletは、単にアクションを保存しておく目的でも使えます。別の実験で同一処理をかけたいときや、別の人のコンピュータで同一処理をしたいときに利用できるでしょう。</p>
<ol>
<li>（上記のアクションを記録するところまでは同じ）</li>
<li>作ったアクションをファイルとして保存する　<code>File</code> &gt; <code>Automate</code> &gt; <code>Create Droplet…</code></li>
<li>Save Droplet In, <code>Choose...</code>より、保存先と名称を指定する</li>
<li>Play, Set:, Action:　作ったアクションが指定されているか確認し、</li>
<li><code>OK</code></li>
<li>拡張子<code>.app</code>のdropletファイルが指定した場所にできる</li>
<li>処理したい連続画像が入ったフォルダを、ドラッグして、ドロップレットファイルに重ねる（アイコンに重ねる）</li>
</ol>
<h3 id="_3">ヒント</h3>
<p>保存先までアクションに入れておくと、特定のフォルダに縮小後ファイルが保存されます。もし、別の実験で同一処理をかけたいときは、別の保存先に変更したいところです。そんなときは、作ったアクションの中の、保存先を指定した一行を削除し、新しい保存先を追記録します。改訂したアクションからDropletをあらためて作ります。</p>
<hr />
<h2 id="_imagejfiji">縮小_ImageJ/FIJI</h2>
<p>FIJI/ImageJは、まえもって基本設定しておきます。大まかな手順として、操作の記録（<code>Plugins</code>&gt; <code>Macros</code>）と、連続画像の処理（<code>Process</code>&gt;<code>Batch</code>）があります。</p>
<ol>
<li>（準備、済んでいれば改めては不要です）ImageJ/FIJIが利用するメモリ量を決める。搭載メモリの75%が推奨最大値。<code>Edit</code>&gt; <code>Options</code>&gt; <code>Memory &amp; Threads...</code>&gt; <code>Maximum Memory</code>。MBで入力、余裕を持って75%より少なめで使っている。64GBなら42GB（42000 MB）など。入力後、いちどImageJ/FIJIを再起動する</li>
<li>（準備、済んでいれば改めては不要です）JPEGの圧縮率を決めておく。<code>Edit</code>&gt; <code>Options</code>&gt; <code>Input/Output...</code>&gt; <code>JPEG quality (0-100)</code>。<code>100</code>をおすすめします。CoMBIの連続画像の場合、データ量はTIFF比較（フォルダの容量）で95で6%へ、100で12%へと減少し、画質は遜色ないかなといった程度です。デフォルトの<code>85</code>では、データ量が2.5%へとかなり減少しますが、画質はかなり低下します</li>
<li>（準備）スケール画像を参照して、ピクセルサイズ（µm/pixel）を計算する。</li>
<li>（準備）縮小させる計画をたて、先のピクセルサイズを参考に縮小後のピクセル数（画像サイズ）を計算しておく。ピクセルサイズが、きりの良い数字になるように縮小している。例えば、5, 10, 20, or 40 µm/pixelの画像シリーズ。管理上便利だかです。最も縮小するシリーズは、一辺が500pixel程度になるようにしたい。のちのズレ補正をスムースに実行できるように。いくつものシリーズを作るときは、各シリーズ個別にマクロを記録するのがいいようです。</li>
<li>（準備）処理後の保存先フォルダを新規につくっておく。</li>
<li>一枚だけ画像を開く</li>
<li>Macroの記録開始。<code>Plugins</code>&gt; <code>Macros</code>&gt; <code>Record</code> ウィンドウ「Recorder」（デフォルトでMacro.ijm.ijmとなっている。名称を変更してもよい。）</li>
<li>縮小する<code>Image</code>&gt; <code>Adjust</code>&gt; <code>Size</code>. 上記で計算しておいたピクセル数（画像サイズ）を入力する。Aspect retioを保つにチェックしてあれば、一辺の入力で済む。Interpolationモードは、<code>None</code>を推奨する（<code>Bicubic</code>でも悪くないが、<code>None</code>のほうがTIFFに近く、シャープに仕上がる）。チェックボタン<code>Average when reduction</code>には、チェックを入れておく。<img alt="segmetation" src="../img/ImageJ_resample.png" /></li>
<li>切り抜く（ブロック周囲がちょうど含まれる画像にしたい。すでに切り抜いてある場合は不要です。）<ol>
<li>メニューバーの左端、四角いアイコンを使って、切り抜きたい領域を選択します。</li>
<li>切り抜きます。<code>Image</code>&gt; <code>Crop</code></li>
</ol>
</li>
<li>マクロファイル（.ijm）を保存します。 <code>Create</code>ボタン。別ウィンドウ「Macro.ijm.ijm」が開く。（名称変更していれば、その名称が表示される）</li>
<li>その別ウィンドウ「Macro.ijm.ijm」がアクティブな状態で、<code>File</code>&gt; <code>Save as</code>。名前を決めて、拡張子.ijmのファイルを保存する。</li>
<li>
<p>画像を閉じる（保存する必要はない）。別ウィンドウ「Macro.ijm.ijm」も「Recorder」も閉じる。</p>
</li>
<li>
<p>いざMacroを実行し、連続画像を一括縮小します。<code>Process</code>&gt;<code>Batch</code>&gt;<code>Macro...</code>　ウィンドウ「Batch Process」が開かれる。</p>
</li>
<li><code>Input</code>, <code>Output</code>　入力フォルダ（元画像連続JPEG）と出力フォルダ（新規フォルダ、空、保存先）を指定。（ヒント：前もって出力フォルダを作っておくこと）</li>
<li><code>Open</code>　保存しておいたマクロファイル（.ijm）を指定し、読み込む</li>
<li><code>Process</code>ボタン</li>
</ol>
<h3 id="ijm">マクロファイル（拡張子ijm）の例</h3>
<p><code>画像サイズを600x450</code>にして、指定の座標で<code>Crop 切り抜き</code>すると、下記のようなマクロファイル（.ijm）ができます。マクロファイルには<code>開く</code>や、<code>閉じる</code>、<code>保存</code>は記録不要で、それらは実行時に指定します。ここで例示したサイズ縮小や切り抜き以外にも、Grayscale変換なども記録して、CoMBI連続画像を処理できます。</p>
<pre><code>run(&quot;Size...&quot;, &quot;width=600 height=450 constrain average interpolation=None&quot;);
makeRectangle(181, 96, 278, 278);
run(&quot;Crop&quot;);
</code></pre>
<p>上記の例では、「縮小＋切り抜き」でブロック周囲をぴったり含む画像にしましたが、もしRAW-JPEG変換時にすでに切り抜いている場合は、ImageJマクロでの「切り抜き（makeRectangleやCrop）」は不要です。その場合、下記のようなシンプルなマクロになります。これなら、Batchに手入力してもよさそうです。</p>
<pre><code>run(&quot;Size...&quot;, &quot;width=600 height=450 constrain average interpolation=None&quot;);
</code></pre>
<h3 id="_4">ヒント</h3>
<ul>
<li>Macro記録では、ファイルの「開く」、「閉じる」、「保存」は、不要です。一括処理を実行するときに保存先を指定できます。Photoshopとは異なるところです。</li>
<li>ImageJ Macroでは、別名保存を細かく設定できませんでした。作りたい画像シリーズが何個もある場合、（たとえば、5 µm/pixel series, 10 µm/pixel series, color series, grayscale series）、別々のマクロを組んだほうがいいようです。Photoshopの場合、別名保存もふくめ、複雑な作業を全部記録してくれます。</li>
<li>メモリに展開できる画像データの量については、別のページ、「コンピュータと画像ファイル」へ</li>
<li>画像を縮小してJPEGを使っていると、ぼやけが許容できないくらいになるかもしれません。データ量の節約のためにJPEGを使いますが、縮小画像になれば、TIFFにして画質が良いままで扱うのもおすすめです。TIFF連続画像が読み込める3D再構築アプリは、3D slicerです。Icyはmulti-TIFF。HorosはTIFFを読み込めません。</li>
<li>参考書：ImageJではじめる生物画像解析（学研メディカル秀潤社、2016）</li>
</ul>
<hr />
<h2 id="_">軽量化_枚数を減らす</h2>
<p>連続画像を1つ飛びにすれば、容量が半分になる。薄く切りすぎて、枚数が増えすぎたとき。解析にはそんなに枚数はいらないとき。3D解析で軽くしたいとき。
MacではFinder、WindowsではExploreで操作します。</p>
<h3 id="mac">Macの場合：</h3>
<ol>
<li>連続画像を複製する。フォルダ上で右クリック、<code>Duplicate</code></li>
<li>複製したフォルダを<code>Finder</code>で表示し、タテに細長く表示する。<code>Show items as icons</code>, Sort by <code>name</code>。ファイル名で並べ替えをする。</li>
<li>2列になるように、Finderの表示幅を調整する。</li>
<li>マウス・トラックパッドをつかって、片方の列のファイルだけ選択する。</li>
<li>右クリックで、<code>New Folder with Selection</code>、フォルダに名前をつけて管理する。（または、選択ファイルを削除して、残りを使用するのでもかまいません）
同様に、3列になるように表示して、1列だけを選択すれば2つ飛ばしのシリーズ（枚数3分の1）を作れます。</li>
</ol>
<h3 id="windows">Windowsの場合：</h3>
<ol>
<li>連続画像を複製する。フォルダ上で右クリック、<code>Copy</code> &amp; <code>Paste</code>。</li>
<li>複製したフォルダを開いて、アイコン表示にする（大、中、小アイコン、どれでも）</li>
<li>ウィンドウの幅を狭くして、2列で表示する。</li>
<li>片方の列のファイルだけ選択する。</li>
<li>選択したファイルを削除。（複製フォルダ内であること。元の連続画像とは別であること）</li>
<li>残ったほうを1つ飛ばしの連続画像として使用できます。</li>
</ol>
<hr />
<h2 id="_5">連続画像のファイル名一括変換</h2>
<p>CoMBIの撮影が通常に成功した場合は、必要ありません。ファイル名が9999から0001に戻ったとか、特別な事情があるときに、ファイル名を一括で連番へと変換します。連番の必要性はアプリによって異なりますが、全過程のどこかで連番が必要でしょうから、どこかで施します。変換後に、元データの元名称がなくなってしまう場合、元データとの照合（実験の再現性）ができるように、メモを残してください。</p>
<ul>
<li>Photoshopによる連続画像処理では、フォルダ内にあれば一括して処理してくれますので、連番は必要ありません。</li>
<li>ImageJのImage Stabilizerでは、頭に連番が必要です。</li>
<li>3D slicerでは、完全な連番が必要です。連番のうしろに残しておいた元ファイル名が飛び飛びの場合、連続画像とは認識されません。完全な連番にしたとき、元データとの照合（実験の再現性）ができるように、メモを残してください。</li>
<li>Horosの場合、頭に連番さえあれば、連続画像として認識してくれます。</li>
</ul>
<table>
<thead>
<tr>
<th>変換前</th>
<th>3Dslicer用の良い例</th>
<th>3Dslicerではダメで<br>Horos, ImageJでは良い例</th>
</tr>
</thead>
<tbody>
<tr>
<td>DSC_9997.jpg</td>
<td>0001.jpg</td>
<td>0001_DSC_9997.jpg</td>
</tr>
<tr>
<td>DSC_9998.jpg</td>
<td>0002.jpg</td>
<td>0002_DSC_9998.jpg</td>
</tr>
<tr>
<td>DSC_9999.jpg</td>
<td>0003.jpg</td>
<td>0003_DSC_9999.jpg</td>
</tr>
<tr>
<td>DSC_0001.jpg</td>
<td>0004.jpg</td>
<td>0004_DSC_0001.jpg</td>
</tr>
<tr>
<td>DSC_0002.jpg</td>
<td>0005.jpg</td>
<td>0005_DSC_0002.jpg</td>
</tr>
<tr>
<td>DSC_0003.jpg</td>
<td>0006.jpg</td>
<td>0006_DSC_0003.jpg</td>
</tr>
</tbody>
</table>
<h3 id="windows-os">Windows OSで一括変換</h3>
<ol>
<li><code>Explore</code>で<code>複数選択</code></li>
<li><code>名称変更</code>すると、「入力文字(1).jpg」と、カッコつき連番数字になる。元のファイル名は残らないので注意。</li>
</ol>
<h3 id="mac-os">Mac OSで一括変換</h3>
<ol>
<li><code>Finder</code>で、複数選択</li>
<li>右クリック（副メニュー）<code>Right click, sub-menu</code>より、ファイル名を変更 <code>Rename</code>。完全変更や連番追記など、ある程度カスタマイズできる。プルダウンメニューの<code>Format</code>, 次のプルダウン、<code>Name and Counter</code>を使う。</li>
</ol>
<h3 id="adobe-bridge">Adobe Bridge（有料アプリ）で一括変換</h3>
<ol>
<li>Bridge内で、変換したいファイルをすべて選んぶ</li>
<li><code>Tool</code>, <code>Batch Rename</code></li>
<li>かなり、細かく設定ができる。</li>
</ol>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © 2021 Tajika Y, CC BY-NC
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6e54b5cd.min.js"></script>
      
    
  </body>
</html>