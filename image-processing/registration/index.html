
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Manual of CoMBI">
      
      
        <meta name="author" content="Tajika Y.">
      
      
      
      
      
      <link rel="icon" href="../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.9">
    
    
      
        <title>Image Registration/ズレ補正 - Manual of CoMBI</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.f2e4d321.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#image-registration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Manual of CoMBI" class="md-header__button md-logo" aria-label="Manual of CoMBI" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Manual of CoMBI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Image Registration/<span style="color:#444C99;">ズレ補正</span>
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Manual of CoMBI" class="md-nav__button md-logo" aria-label="Manual of CoMBI" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    Manual of CoMBI
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Top page
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Installation/導入
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Installation/導入
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/system/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Overview/概要
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/camera/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Imaging devices/カメラなど
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/selfmade/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Self-made devices/自作装置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/computer/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Computer and storage/コンピュータとストレージ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devices/application/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Applications/アプリケーション
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Instruction/操作
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Instruction/操作
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/frozenblock/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Frozen Block
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/paraffinblock/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Paraffin Block
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/camerasettings/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Camera Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/tethering/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tethering (optional)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-u/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CoMBI-U (Universal)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-c/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CoMBI-C (Cryostat)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-s/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CoMBI-S (Sliding, motorized)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-s-m/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CoMBI-S (Sliding, manual)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operation/combi-r/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CoMBI-R (Rotary, manual)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Image Processing/画像処理
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Image Processing/画像処理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview/概要
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rawjpeg/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RAW to JPEG conversion/RAW現像
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scale/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resizing and Reducing/画像の縮小
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Image Registration/ズレ補正
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../automation/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automation/自動処理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3dslicer/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3D Reconstruction, 3D slicer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../icy/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3D Reconstruction, Icy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../horos/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3D Reconstruction, Horos/OsiriX
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../correlation/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Correlation of 2D and 3D images/3D像に切片位置を示す
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../EDF/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extended Depth of Field/深度合成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ilastik/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Segmentation by ilastik/セグメンテーション
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/gallery/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gallery/作品集
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../publication/publication/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Publications/論文
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Electronics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Electronics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/ATmega328P/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ATmega328P standalone/単体利用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/Arduino_serialplot/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arduino Serial Plotter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/Arduino_micro/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arduino micro bootloader/書き換え
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/Arduino_USBcable/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arduino USB cable/ケーブル相性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/terminal/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crimped terminal/圧着端子
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/vender/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Venders/パーツの入手先
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/mkdocs/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mkdocs-material/HPづくり
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/camera_terminal/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Camera terminal/カメラ端子
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/Rstudio/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rstudio/練習中
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/macgpu/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3Ddata on Mac
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electronics/KiCAD/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KiCAD PCD design
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#applications" class="md-nav__link">
    <span class="md-ellipsis">
      Applications/アプリケーション
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#procedure" class="md-nav__link">
    <span class="md-ellipsis">
      Procedure/手順
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#correct-log-filelog" class="md-nav__link">
    <span class="md-ellipsis">
      Correct log file/Logファイルを修正する
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Correct log file/Logファイルを修正する">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#procedure-for-correcting-log" class="md-nav__link">
    <span class="md-ellipsis">
      Procedure for correcting log/修正手順
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiply-log-valueslog" class="md-nav__link">
    <span class="md-ellipsis">
      Multiply log values/Logファイルを倍加する
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tips" class="md-nav__link">
    <span class="md-ellipsis">
      Tips/ヒント
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tips/ヒント">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#too-slow" class="md-nav__link">
    <span class="md-ellipsis">
      Too slow/おそい
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failure" class="md-nav__link">
    <span class="md-ellipsis">
      Failure/うまくいかない
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dont-give-up" class="md-nav__link">
    <span class="md-ellipsis">
      Don't give up/どうしてもだめ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imagejfiji-cant-open-log-fileimagejfijiimage-stabilizer-log-applier" class="md-nav__link">
    <span class="md-ellipsis">
      ImageJ/FIJI can't open log file/新版ImageJ/FIJIのバグ、Image Stabilizer Log Applierができない？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageJ/FIJI can't open log file/新版ImageJ/FIJIのバグ、Image Stabilizer Log Applierができない？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-use-imagej-1" class="md-nav__link">
    <span class="md-ellipsis">
      1. Use ImageJ 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-use-old-fiji" class="md-nav__link">
    <span class="md-ellipsis">
      2. Use old FIJI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-copy-and-paste" class="md-nav__link">
    <span class="md-ellipsis">
      3. Copy and paste
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="image-registration">Image Registration/<span style="color:#444C99;">ズレ補正</span></h1>
<p>(This page is still in Japanease only.)</p>
<h2 id="applications">Applications/<span style="color:#444C99;">アプリケーション</span></h2>
<ul>
<li>
<p>ImageJ <strong>1</strong> (recommended)(not FIJI's ImageJ<strong>2</strong>, which can't open CSV properly.)</p>
<p><a href="https://imagej.nih.gov/ij/download.html">https://imagej.nih.gov/ij/download.html</a></p>
</li>
<li>
<p>ImageJ plug-ins "Image Stabilizer" and "Image Stabilizer Log Applier"</p>
<p><a href="https://imagej.net/plugins/image-stabilizer">https://imagej.net/plugins/image-stabilizer</a></p>
</li>
<li>
<p>MS Excel</p>
</li>
</ul>
<p>Install the ImageJ plugin by referring to the link above. For macOS, <code>Right click (sub menu)</code> on the <code>/Application/Fiji.app</code> &gt; <code>Show packege contents</code>. Drag and drop downloaded files into <code>/plugins</code>. Restart ImageJ. <br>
I chose <code>Image Stabilizer</code> among many registration tools. The advantage is that it can export the distance (pixels) moved as a log file. Even if there is a point where registration fails, you can correct the values in the log file to ensure successful registration. Furthermore, by doubling the values in the log file, you can apply registration to large images as well.<br> 
In 2022.June, I have developed ImageJ macro and Excel VBA to do all the registration automatically. Please refer to <a href="https://github.com/combi-3d/ImageJ">GitHub CoMBI_ImageJ</a></p>
<p><span style="color:#444C99;">ImageJ/FIJIに上記リンクを参考に、プラグインをインストールします。Macの場合、Finderで操作します。<code>/Application/Fiji.app</code>の上で、<code>右クリック</code>、<code>Show packege contents</code>。<code>/plugins</code>のなかにダウンロードしたファイルをドラッグ・アンド・ドロップし、ImageJ/FIJIを再起動します。<br>
数あるRegistrationツールの中から、Image Stabilizerをえらびました。移動させた距離（ピクセル）をLogファイルとして記録シてくれるのがポイントです。万が一、ズレ補正に失敗する箇所があっても、Logファイルの数値を修正することで、ズレ補正を成功に導けます。さらに、Logファイルの数値を倍加することで、大きな画像にもズレ補正をかけられます。<br>
現在、ImageJ macroとExcel VBAで、Registrationをすべて自動でできるようになっています。<a href="https://github.com/combi-3d/ImageJ">GitHub CoMBI_ImageJ</a>をご参照のうえ、ぜひご利用ください。（2022.6）</span></p>
<h2 id="procedure">Procedure/<span style="color:#444C99;">手順</span></h2>
<p>ImageJ macro is available to do steps 3-8 automatically.<a href="https://github.com/combi-3d/ImageJ">GitHub CoMBI_ImageJ</a>（2022.6). Manual operetion is described below. </p>
<ol>
<li>(Preparation) Set memory size that ImageJ can use. 75% of on-board RAM is recommended.<code>Edit</code>&gt; <code>Options</code>&gt; <code>Memory &amp; Threads...</code>&gt; <code>Maximum Memory</code>. Input as MB. Ex: RAM64GB, input 42GB（42000 MB）. Restart ImageJ.</li>
<li>(Preparation) Set JPEG compression rate. <code>Edit</code>&gt; <code>Options</code>&gt; <code>Input/Output...</code>&gt; <code>JPEG quality (0-100)</code>. <code>100</code> is recommended. For CoMBI data, image data size are reduced to 6% by <code>95</code>, 12% by <code>100</code> (Comparison with TIFF size). Image quality seems to be maintained. Do not use default value <code>85</code>, since it reduces data into 2.5% and also reduces the quality of images too much.</li>
<li>Open serial images. Drag and drop a folder containing images to ImageJ bar. Max data size is about 1000x1000 pixesl, 1000 images, though it depends on RAM. Open them all in the RAM, since Image Registration requires to do so.</li>
<li><code>Plug-ins</code>, <code>Image Stabilizer</code>.　Registration begins from opening position. If opening the first image, register from the first to last (Forward). If opening last, register from last to first (Backward). Check <code>Save Log</code>. It is better to check <code>Create as a new series</code> if RAM is enough, since it is useful for evaluating success or failure.</li>
<li>Browse registered series. Useful tool: <code>Analyze</code>&gt;<code>Tools</code>&gt;<code>Synchronize Windows</code> allow to compare between original series and registered series.</li>
<li><code>Save as</code>, <code>Image Sequense...</code> Check <code>Use original file name</code></li>
<li><code>Save</code> log files. Extension is .log, but its a simple text or csv file. If you register both forward and backward, save both log files with identical names, ex. forward.log, backward.log.</li>
<li>If you find some failure, remember the place (Image number from the front). Keep the place of failure and log files, no need to keep serial images which contains failure.</li>
</ol>
<h2 id="_1"></h2>
<p><span style="color:#444C99;">ImageJ macroで、下記の手順3-8は、自動で行えます。<a href="https://github.com/combi-3d/ImageJ">GitHub CoMBI_ImageJ</a>（2022.6）</span></p>
<ol>
<li><span style="color:#444C99;">（準備、済んでいれば改めては不要です）ImageJ/FIJIが利用するメモリ量を決める。搭載メモリの75%が推奨最大値。<code>Edit</code>&gt; <code>Options</code>&gt; <code>Memory &amp; Threads...</code>&gt; <code>Maximum Memory</code>。MBで入力、余裕を持って全メモリ量の75%を超えないように設定している。例えば、64GBなら42GB（42000 MB）など。入力後、いちどImageJ/FIJIを再起動する</span></li>
<li><span style="color:#444C99;">（準備、済んでいれば改めては不要です）JPEGの圧縮率を決めておく。<code>Edit</code>&gt; <code>Options</code>&gt; <code>Input/Output...</code>&gt; <code>JPEG quality (0-100)</code>。<code>100</code>をおすすめします。CoMBIの連続画像の場合、データ量はTIFF比較（フォルダの容量）で95で6%へ、100で12%へと減少し、画質は遜色ないかなといった程度です。デフォルトの<code>85</code>では、データ量が2.5%へとかなり減少しますが、画質はかなり低下します</span></li>
<li><span style="color:#444C99;">連続画像をひらく　フォルダごとImageJのバーにドラッグアンドドロップ。搭載メモリと相談ですが、おおかた1000x1000x1000枚の画像が限度です。メモリに展開してください。かつてはVirtual Stackでもできましたが、ImageJのバージョンアップ後、逐次保存ができなくなりました。</span></li>
<li><span style="color:#444C99;"><code>Plug-ins</code>, <code>Image Stabilizer</code>　このとき一番前の画像を開いておけば、前から順にに補正をかけます。一番後ろの画像を開いておけば、後ろから補正します。Logファイルを生成するに必ずチェックをいれます。もし、メモリが潤沢なら、結果を別ファイルで表示するにチェックしたほうがよく、補正の成否確認に便利です。</span></li>
<li><span style="color:#444C99;">パラパラとめくってみて、成功していれば、ラッキー。完了です。（ちょっと便利：<code>Analyze</code>&gt;<code>Tools</code>&gt;<code>Synchronize Windows</code>で、補正前後の連続画像を同期してめくれます）</span></li>
<li><span style="color:#444C99;">補正に成功した連続画像を保存するには、<code>Save as</code>, <code>Image Sequense...</code> 元のファイル名を使うに、チェック。</span></li>
<li><span style="color:#444C99;">ログファイルも保存します。拡張子は、.logで、テキストファイルです。</span><ul>
<li><span style="color:#444C99;">前から補正したlogファイルと、後ろから補正したlogファイルがあれば、区別できるようにファイル名をつけて保存します。例、<strong>前から.log、後から.logとか</strong>（以降の説明ではこの名称を使います）、forward.log、backward.logとか。</span></li>
</ul>
</li>
<li><span style="color:#444C99;">補正に失敗した場合、失敗箇所（前から何枚目か）のメモをとります。このメモと、logファイルさえ保存しておけば、失敗連続画像を保存する必要はありません。</span></li>
</ol>
<h2 id="correct-log-filelog">Correct log file/<span style="color:#444C99;">Logファイルを修正する</span></h2>
<p>If there is a failure, do not give up. Modify the Log files. The Log file has four columns of numbers as below; 
<br><span style="color:#444C99;">ズレ補正に失敗があっても、あきらめません。Logファイルをエクセルなどで修正します。Logファイルには、4列の数値があります。</span></p>
<ol>
<li>Image number　画像の順番</li>
<li>Register forward or backward (1 or -1) <span style="color:#444C99;">補正は前に進んだか後に進んだか</span></li>
<li>Horizontal correction distance <span style="color:#444C99;">ヨコの補正距離</span></li>
<li>Vertical correction distance <span style="color:#444C99;">タテの補正距離</span></li>
</ol>
<p>There are two types of failures, and they are recorded separately in the notes. In the figure below, "only one image jumped out" occurred in the 699th and 742nd images during forward registration. In the 762nd (forward) and 318th (backward), a "shift" has occurred. To correct these failure, the correct part of the forward.log and the correct part of backward.log are combined and saved as a new log.
<br><span style="color:#444C99;">補正失敗には2通りあり、失敗箇所のメモでは区別して記録します。下図では、前から補正の699、742枚目で"一枚だけ飛び出し"が起こっています。前から補正の762、後ろから補正の318では、"移動"が起こっています。失敗箇所を修正するためには、前から.logの正しいところと、後ろから.logの正しいところを合体させて、全体が正しいlogファイルを新しく作ります。</span></p>
<ol>
<li><span style="color:#444C99;">"only one image jumped out"1枚だけが飛び出ている</span></li>
<li><span style="color:#444C99;">"shift" 1枚ずれるとそれ以降もずれたままになる</span></li>
</ol>
<p><img alt="3D slicer open" src="../img/imagestabilizer01.png" title="open" /></p>
<p><em>Examle of forward and backward registraion. <span style="color:#444C99;">前から補正と後ろから補正の結果の例</span></em></p>
<h3 id="procedure-for-correcting-log">Procedure for correcting log/<span style="color:#444C99;">修正手順</span></h3>
<p>Manual operetion is described below. All procedure can be done automatically using Excel macro. Refer <a href="http;//github.io/CoMBI_artisan">GitHub CoMBI_artisan</a> (2022.6).</p>
<ol>
<li>Prepare Excel, forward.log, Backward.log, Memo of failure location.</li>
<li>Forward.log is imported into Excel, <code>File</code>&gt; <code>Import</code>、<code>Text file</code>、<code>Import</code>. Select a log file and <code>Get Data</code>.</li>
<li>Text import wizard<ol>
<li>Check <code>Delimited</code></li>
<li>File origin: <code>Macintosh</code> for macOS　</li>
<li>Button <code>Next</code>.</li>
<li>Check <code>Commma</code></li>
<li>Button <code>Finish</code></li>
<li>Existing sheet, sheet1, </li>
<li>Button <code>OK</code></li>
</ol>
</li>
<li>Add Sheet2, and import Backward.log as same as described above.</li>
<li>Sort Backward.log<ol>
<li>Select all four colomn.</li>
<li>Tab <code>Data</code></li>
<li><code>Sort</code>, Sort by <code>Column A</code>, Order <code>A-Z</code>, </li>
<li>Button <code>OK</code></li>
</ol>
</li>
<li>Copy and paste the sorted Backward.log in the next colomn to Forward.log（Sheet1).</li>
<li>
<p>Correct the value at the failure location.</p>
<ol>
<li>Mark the failure location with color.</li>
<li>
<p>In case of "one image is jumped out"</p>
<ul>
<li>Add <strong>difference</strong> using a formula below.</li>
<li>(correct value)=(value before failure location) + (Correct log at the same place) - (Correct log, one cell before）</li>
<li>Apply to both horizontal and vertical correction distances.</li>
</ul>
</li>
<li>
<p>In case of "shift"</p>
<ol>
<li>In the new colomn,</li>
<li>At the begining of "shift", add <strong>difference</strong>.</li>
<li>After the begining point, create correct value;<ul>
<li>(Correct value) = (Correct begining point value) + (Correct log, the same location) - (Correct log, one cell before）</li>
</ul>
</li>
<li><code>Auto Fill</code> the formula below cells.</li>
<li>Correct both horizontal and vertical correction distance.
<br>
<img alt="IS log補正" src="../img/imagestabilizer02.png" title="log" />
<em>Correct the begining of "shift" at 699. 699以降で移動している例（上の図とは異なります）　まず、新しい列で、699の正しいヨコ補正距離を計算している（緑枠）</em>
<br>
<img alt="IS log補正" src="../img/imagestabilizer03.png" title="log" />
<em>Correct the value after the begining.（タテ補正距離も計算したあと）、つぎに、正しい移動距離数値より以降のセルに、正しい移動距離をつくる</em>
<br></li>
</ol>
</li>
</ol>
</li>
<li>
<p>Make corrected log, which has the style of log file as "title in the first line, values in the below lines, four colomn".</p>
<ol>
<li>Create new sheet.</li>
<li>Copy and paste correct values. <code>Edit</code>, <code>Paste Special...</code>, Check <code>Values</code>, <code>OK</code>.</li>
</ol>
</li>
<li>Save as xlsx format file.</li>
<li>Save a sheet with corrected value as a csv format file. <code>File</code>&gt; <code>Save as</code>, File Format:<code>csv</code>.</li>
<li>In Finder (macOS), rename csv file from <code>.csv</code> to <code>.log</code>. Press button <code>use log</code>.</li>
<li>In Finder (macOS), open in TextEdit. <code>Right click</code>, <code>Open with</code>, <code>TextEdit.app</code>.</li>
<li>Delete needless charactors. 6x(") 3x(,) in the 1st line, 3x(,) in the 2nd line. With these needless charactors, Image Stabilizer Log Applier can't recognize log files.</li>
<li>
<p>(In the rare case, delete "space" in the 1st and 2nd lines.)
    <img alt="IS log補正" src="../img/imagestabilizer04.png" title="log" />
    <em>Delete needless charactors. 余計な文字を削除</em></p>
</li>
<li>
<p><code>File</code>&gt; <code>Save</code>. Complete!</p>
</li>
<li>In ImageJ, open serial images and correct log file. <code>Plug-ins</code>, <code>Image Stabilizer Log Applier</code>. Note: Some versions of ImageJ/FIJI can't open log file. See below.</li>
</ol>
<h3 id="_2"></h3>
<p><span style="color:#444C99;">下記は、手作業で修正する手順です。エクセルVBAで全自動でできます。<a href="http;//github.io/CoMBI_artisan">GitHub CoMBI_artisan</a>をご参照ください。（2022.6）</span></p>
<ol>
<li><span style="color:#444C99;">用意するものは、前から.log、後から.log、失敗箇所のメモ</span></li>
<li><span style="color:#444C99;">Excelで、Sheet1に前から.logをインポートします。<code>File</code>&gt; <code>Import</code>、<code>Text file</code>、<code>Importボタン</code>ファイルをえらんで<code>Get Data</code></span></li>
<li><span style="color:#444C99;">Text import wizard</span><ol>
<li><span style="color:#444C99;"><code>Delimited</code>にチェック、</span></li>
<li><span style="color:#444C99;">File originは、Macなら<code>Macintosh</code>　</span></li>
<li><span style="color:#444C99;">ボタン<code>Next</code></span></li>
<li><span style="color:#444C99;"><code>Commma</code>にチェック、</span></li>
<li><span style="color:#444C99;">ボタン<code>Finish</code></span></li>
<li><span style="color:#444C99;">Existing sheet, sheet1, </span></li>
<li><span style="color:#444C99;">ボタン<code>OK</code></span></li>
</ol>
</li>
<li><span style="color:#444C99;">Excelで、Sheet2を用意し、上記と同様に、後から.logをsheet2にインポートします。</span></li>
<li><span style="color:#444C99;">後から.logは降順になっているので、昇順になおします。</span><ol>
<li><span style="color:#444C99;">4列とも、選択する。</span></li>
<li><span style="color:#444C99;">タブ<code>Data</code></span></li>
<li><span style="color:#444C99;"><code>Sort</code>, Sort by <code>Column A</code>, Order <code>A-Z</code>, </span></li>
<li><span style="color:#444C99;">ボタン<code>OK</code></span></li>
</ol>
</li>
<li><span style="color:#444C99;">前から.log（Sheet1）のすぐ隣に、後から.log（Sheet2）をコピペする</span></li>
<li>
<p><span style="color:#444C99;">失敗位置を修正する</span></p>
<ol>
<li><span style="color:#444C99;">失敗箇所を、色を違えるなどして、マークする。</span></li>
<li>
<p><span style="color:#444C99;">「一枚だけ飛び出ている」場合</span></p>
<ul>
<li><span style="color:#444C99;">失敗場所だけ、<strong>差分</strong>を加算する。下の式。</span></li>
<li><span style="color:#444C99;">（失敗場所の本来の移動距離）=(失敗場所のひとつ前）+（正しいlogの同じ場所 - 正しいlogのひとつ前）</span></li>
<li><span style="color:#444C99;">ヨコの補正距離、タテの補正距離、の両方に施すこと。</span></li>
</ul>
</li>
<li>
<p><span style="color:#444C99;">「1箇所以降ごっそり移動」の場合</span></p>
<ol>
<li><span style="color:#444C99;">新しい列で作業します。</span></li>
<li><span style="color:#444C99;">まず、ズレはじめの場所で、差分を加算して修正し（上記の式）、正しい移動距離を新しい列に記載します。</span></li>
<li><span style="color:#444C99;">つぎに、正しい移動距離数値より以降のセルに、正しい移動距離をつくります。</span><ul>
<li><span style="color:#444C99;">（以降の正しい移動距離）=(前項でつくった正しい移動距離）+（正しいlogの同じ場所 - 正しいlogのひとつ前）</span></li>
</ul>
</li>
<li><span style="color:#444C99;">以降セルすべてに適用します。Auto Fillという機能で、選択したセルの四角いマークを下へ伸ばします。</span>
<br>
<img alt="IS log補正" src="../img/imagestabilizer02.png" title="log" />
<em><span style="color:#444C99;">699以降で移動している例（上の図とは異なります）　まず、新しい列で、699の正しいヨコ補正距離を計算している（緑枠）</span></em>
<br>
<img alt="IS log補正" src="../img/imagestabilizer03.png" title="log" />
<em><span style="color:#444C99;">（タテ補正距離も計算したあと）、つぎに、正しい移動距離数値より以降のセルに、正しい移動距離をつくる</span></em>
<br></li>
</ol>
</li>
</ol>
</li>
<li>
<p><span style="color:#444C99;">修正がすんだら、元のLogファイルと同じデザインにします。「1行目はタイトル行、その下に枚数分の行数があって、各4桁」にします。</span></p>
<ol>
<li><span style="color:#444C99;">新しいシートをつくる</span></li>
<li><span style="color:#444C99;">そこに、計算結果の数値をコピペする。Excelなら、<code>Edit</code>, <code>Paste Special...</code>, <code>Valuesチェック</code>, <code>OKボタン</code>を使います。</span></li>
</ol>
</li>
<li><span style="color:#444C99;">ここで、いったん、xlsx形式で保存しておきます。</span></li>
<li><span style="color:#444C99;">次に、別名保存で、csv形式で保存します。<code>File</code>&gt; <code>Save as</code>, File Format:<code>csv</code>　CSVファイルは、Sheetごとにしか保存できません。</span></li>
<li><span style="color:#444C99;">Finderで、保存したcsvファイル名の拡張子を書き換えます。<code>.csv</code>から<code>.log</code>へ。メッセージがでて、ボタン<code>use log</code>をクリック。</span></li>
<li><span style="color:#444C99;">Finderで、そのファイルをテキストエディタで開く。<code>右クリック</code>, <code>Open with</code>, <code>TextEdit.app</code></span></li>
<li>
<p><span style="color:#444C99;">余計な文字を削除する。1行目の「"」6個、「,」3個、2行目の「,」3個を削除。（この作業を忘れると、のちのLog Applierで認識してくれません。もとのLogファイルとそっくりにします。特に１行目、２行目、最終行を確認。余計なスペースがあったら削除。）</span>
    <img alt="IS log補正" src="../img/imagestabilizer04.png" title="log" />
    <em><span style="color:#444C99;">余計な文字を削除</span></em></p>
</li>
<li>
<p><span style="color:#444C99;">保存、<code>File</code>&gt; <code>Save</code>。これで修正Logファイルの完成です。</span></p>
</li>
<li><span style="color:#444C99;">ImageJ/FIJI, <code>Plug-ins</code>, <code>Image Stabilizer Log Applier</code>にかけます。連続画像と、修正したlogファイルを開いておいてから、Applierを実行します。（注、最新のImageJ/FIJIには、logファイルを開くときにバグがあります。対策は下記）</span></li>
</ol>
<h2 id="multiply-log-valueslog">Multiply log values/<span style="color:#444C99;">Logファイルを倍加する</span></h2>
<p>For example, if "Image Stabilizer" is successfully applied to a series of 500x500 pixels, 40 µm/pixel, you can double all the values in the Log file and apply "Image Stabilizer Log Applier" to a series of 1000x1000 pixels, 20 µm/pixel. This Log Applier is low load on the computer, and can register a heavy serial images.</p>
<p><span style="color:#444C99;">例えば、「500x500 pixels, 40 µm/pixel」の連続画像で、Image Stabilizer（ズレ補正）に成功すれば、Logファイルの数値ぜんぶを2倍にして、「1000x1000 pixels, 20 µm/pixel」の連続画像に、Image Stabilizer Log Applierをかけることができます。Log Applierはパソコンへの負荷が低いので、重い連続画像でズレ補正する際に、重宝しています。</span></p>
<p>Then, can values be multiplied by 4 and applied to "2000x2000 pixels, 10µm/pixel"? The data is too heavy, so you may need to be a little creative. If you <strong>prepare a serial images (e.g., 1000x1000, 10µm/pixel) with the desired area cropped</strong>, you can apply it to Applier and make a high-resolution 3D observation. "Image Stabilizer", the first step in the process, uses the block contour as the basis for the registration, so the registration can only be applied to images captureing a wide area. In contrast, "Image Stabilizer Log Applier" no longer requires the block contour, and is used for both "low-magnification 3D observation of the entire sample" and "high-definition 3D observation of only the areas you are interested. The modified log file makes such observation possible.</p>
<p><span style="color:#444C99;">では、4倍にして、「2000x2000 pixels, 10µm/pixel」の連続画像にかけられるか？これは、データ量が多くなるので、ちょっと工夫が必要になるかもしれません。<strong>高精細さはそのままに、観たいところだけクロップ</strong>した連続画像「例、1000x1000, 10µm/pixel」を用意すれば、Applierにかけられ、高精細観察ができます。最初に行う、Image Stabilizerは、ブロック周囲形状をズレ補正の基準にしているので、ズレ補正は、広く写した画像にしか適用できません。一方、Image Stabilizer Log Applierでは、ブロック周囲形状は、もはや必要ありません。「試料全体で低倍率の3D観察」と「観たいところだけで高精細の3D観察」を分けて行っています。倍加logファイルがそういう観察を可能にしてくれています。</span></p>
<p>How much can values be multiplied? 2x and 4x works fine in many cases. 8x 10x can register but not so properly. More than 10x ? I don't need, since the original image is up to about 8000x6000 pixels, and 1/10 is 800x600 pixels, which is light enough to register.</p>
<p><span style="color:#444C99;">どこまで倍加できるのか？2倍、4倍までなら、余裕でキレイに補正してくれます。8倍、10倍は？ズレ補正が甘い場合があります、うまくいくときはうまくいきます。10倍以上の倍加は？通常そんなに倍加することはありません。オリジナル画像は最大約8000x6000 pixelsで、10分の1だと800x600 pixels。余裕でズレ補正できる軽さになるからです。</span></p>
<h2 id="tips">Tips/<span style="color:#444C99;">ヒント</span></h2>
<h3 id="too-slow">Too slow/<span style="color:#444C99;">おそい</span></h3>
<ul>
<li>Are the images too large? Typically, I try to start with a serial images of 500x500 widh a high success rate. Once you have the log file, you can double the values to make the log applier for larger images.</li>
<li>Reduce the amount of data by resizing and cropping. Crop is done when converting from RAW to JPEG or when resizing in Photoshop or ImageJ, so that the blockface and a little of the surrounding area remain.</li>
<li>Grayscale images are lighter than color images, one-third, and suitable for registration.</li>
<li>I have also used only odd numbers or even numbers, when I sliced too thin. For macOS, first make the Finder appear vertically elongated and then select "icon view". Icons appear in two columns, then select one of the columns with the mouse and group them into a new folder.</li>
</ul>
<h3 id="_3"></h3>
<ul>
<li><span style="color:#444C99;">画像が大きすぎませんか。はじめは小さく縮小した連続画像からやってみて、Logファイルをゲットします。具体的には、はじめは500x500程度で、成功率は高いです。つぎに750x750程度、さらに1000x1000程度で成功すればラッキーです。Logファイルさえ入手できれば、そのまま使うもよし、数値を倍加するなどして、大きなままの連続画像に対してLog Applierするもよし。</span></li>
<li><span style="color:#444C99;">画像のデータ量を少なくする (1)：縮小やクロップで少なくしています。クロップは、RAW−JPEG変換時またはPhotoshop, ImageJで縮小するときにやっていて、ブロック面と周辺少しが残る程度にしています。</span></li>
<li><span style="color:#444C99;">画像のデータ量を少なくする (2)：カラー画像よりも、グレースケール画像のほうが軽いです。3分の1。</span></li>
<li><span style="color:#444C99;">画像データ量を少なくする、別の技。奇数番号だけ、偶数番号だけにしたこともあります。これは、切削を薄くしすぎた、過剰だったときに行ないます。Macの場合、まず、Finderを縦に細長く表示させ、アイコン表示にします。2列に表示されれば、マウスで片方の列だけ選択して、新しいフォルダにまとめます。</span></li>
</ul>
<h3 id="failure">Failure/<span style="color:#444C99;">うまくいかない</span></h3>
<ul>
<li>Sometimes it works on the first try, and in rare cases, I have to struggle for two days or so. However, I have experienced over 200 samples imaged with CoMBI, and have never failed to register. I am sure we can do it. The fastest record of a successful CoMBI is that 8 mouse brain were imaged with CoMBI and images were successfully registered within 2 days. <ul>
<li>Try Image Stabilizer forward and backward</li>
<li>Correct log files of Image Stabilizer</li>
<li>Apply Image Stabilizer 2 times or 3 times. Later, add up values and use for "Log Applier". To keep image quality high, do not save images every time after registration, but save log files only. Modify Log and conduct "Applier" once.</li>
<li>Make sure that images containd the conture of block. Do not crop too much.</li>
<li>Registration may fail at the block covered with debris. Discard the image covered with debris and use an adjacent image to complete. Duplicate the neighboring image and rename the file. Leave a record in the experiment notebook.</li>
<li>Registration may fail where imaging has failed. For example, a block has passed the shooting point. Discard the image covered with debris and use an adjacent image to complete. Or crop manually to make correction distance minimal.</li>
<li>If the contrast is too low, it may not work. Create high contrast series and try registration with them. Once you can get log file, you can apply othre series.</li>
</ul>
</li>
</ul>
<h3 id="_4"></h3>
<ul>
<li><span style="color:#444C99;">一発でうまくいくときから、まれに2日間ほど悩むときもあります。しかし、これまで200サンプル以上のCoMBI撮影を経験し、ズレ補正に失敗したことはありません。きっとどうにかできるはずです。うまくいったときの最速記録は、8サンプルのCoMBI撮影からズレ補正までを丸2日間で成功させたというものです。</span><ul>
<li><span style="color:#444C99;">Image Stabilizerを最初の画像からやってみてだめなら、後ろからやってみる。</span></li>
<li><span style="color:#444C99;">Image StabilizerのLog（前からLogと後ろからLog）を修正する。</span></li>
<li><span style="color:#444C99;">前から後から、何度でもやってみる。あとでLogを足し合わせ、Applier。毎度修正連続画像を保存していると画質が低下するので、Logは複数回分、Applierで一回にする。</span></li>
</ul>
</li>
<li><span style="color:#444C99;">これらでできない場合は：</span><ul>
<li><span style="color:#444C99;">ブロックの外周で補正がかかります。画像にブロック外周が含まれていますか？クロップしすぎていませんか。</span></li>
<li><span style="color:#444C99;">ゴミがかかっている画像で、ズレ補正が失敗することがあります。ゴミをかぶった画像はすてて、隣の画像で補完してください。隣を複製し、ファイル名をかえます。実験ノートに記録をのこします。</span></li>
<li><span style="color:#444C99;">撮影に失敗した箇所で、ズレ補正が失敗することがあります。たとえば撮影ポイントを通り過ぎてしまった一コマなど。手動クリオスタットの場合にときどきあります。ひどい場合は、捨てて隣で補完します。惜しいときは、クロップ（RAW-JPEG変換時か、PhotoshopやImageJでやったか）するときに、手動でクロップ位置を修正します。</span></li>
<li><span style="color:#444C99;">コントラストが低すぎると、うまくいかないかもしれません。コントラストをどぎつくしたバーションもつくってみて、Image Stabilizerをやってみます。Logファイルさえ手に入れば、好みのコントラストシリーズにもLog Applierをかけられます。</span></li>
</ul>
</li>
</ul>
<h3 id="dont-give-up">Don't give up/<span style="color:#444C99;">どうしてもだめ</span></h3>
<p>Contact me. I never give up.
<span style="color:#444C99;"><br>どうしてもダメなら、ご連絡ください。無敗ですので。</span></p>
<h2 id="imagejfiji-cant-open-log-fileimagejfijiimage-stabilizer-log-applier">ImageJ/FIJI can't open log file/<span style="color:#444C99;">新版ImageJ/FIJIのバグ、Image Stabilizer Log Applierができない？</span></h2>
<p>After updating ImageJ/FIJI to the latest version, when I open a Log file in the Image Stabilizer Log Applier, the line breaks are gone. This may be a bug when I reopen a saved Log file. Mac OS 10.15.6(August 2020), Windows 10 (October 2020), and Linux/Ubuntu 20.04 (April 2021) also show the same symptoms (Thank you! T). According to the FIJI website, a major update was made in August 2020. The bug may appear after August 2020.</p>
<p><span style="color:#444C99;">ImageJ/FIJIを最新にアップデートしたら、Image Stabilizer Log ApplierでLogファイルをひらくと、改行がなくなってしまい、使えなくなります。いつもどおり、Image Stabilizerはできるし、Logファイルも正しく生成はされます。一旦保存したLogファイルを再び開くときだけのバグです。改行コードの扱いに関するようにもみえるし、FIJIがテキストファイルを認識するとき、利用するウィンドウ種の選択がおかしくなったようにもみえます。FIJIのサイトによると、2020年8月に大型アップデートを施したそうです。2020年8月Mac OS 10.15.6、および2020年10月Windows10、2021年4月Linux/Ubuntu20.04でも同様の症状がでます（Thank you! T)。いまのところ、以下の対策<strong>いずれか</strong>で使えるようになります。</span></p>
<h3 id="1-use-imagej-1">1. Use ImageJ 1</h3>
<p>Use ImageJ<strong>1</strong> instead of FIJI/ImageJ<strong>2</strong>. version 1.53k as of 2022.6 does not cause the above problem with Image Stabilizer Log Applier. Test environment was 2022.6.3 "ImageJ 1.53k Java 1.8.0_172, macOS12.4, iMac27_2017", "ImageJ 1.53k bundled with Zulu OpenJDK 13.0.6, macOS12.4, MacBookPro16_2021_M1_max". Download from the links below, according to your environment: MacOS(Intel), MacOS(ARM), Linux, Windows.
<a href="https://imagej.nih.gov/ij/download.html">https://imagej.nih.gov/ij/download.html</a></p>
<p><span style="color:#444C99;">FIJI/ImageJ<strong>2</strong>ではなく、ImageJ<strong>1</strong>を使う。2022.6現在のバージョン1.53kでは、Image Stabilizer Log Applierに上記のような問題は起こりません。テスト環境は、2022.6.3「ImageJ 1.53k Java 1.8.0_172, macOS12.4, iMac27_2017」、「ImageJ 1.53k bundled with Zulu OpenJDK 13.0.6, macOS12.4, MacBookPro16_2021_M1_max」です。上記のリンク先から、それぞれの環境に合わせて、ダウンロードします。MacOS(Intel), MacOS(ARM), Linux, Windows</span></p>
<p>However, MacOS (Intel mac, M1 mac) will not start straight away due to security reasons.</p>
<ol>
<li>Downloaded file will saved in <code>Download</code> folder. Move it to <code>Application</code> folder.</li>
<li>If you try to open it by double-click in the <code>Application</code> folder, you will find “ImageJ.app cannot be opened because the developer cannot be verified. macOS cannot verify that this app is free from malware". Then, only <code>Cancel</code> can be done.</li>
<li>Move ImageJ icon to the Dock bar by drag and drop from <code>Application</code> to Dock.</li>
<li>Over the ImageJ icon in the Dock, <code>right click</code> &gt; <code>Open</code></li>
<li>You will find message as "macOS cannot verify the developer of ImageJ.app. Are you sure you want to open it?". This time, you can choose <code>Open</code>!</li>
<li>Once you <code>Open</code>, you can open ImageJ without any messages.</li>
</ol>
<p><span style="color:#444C99;">ただし、MacOS（Intel mac、M1 mac）の場合、セキュリティの関係で素直には起動しません。</span></p>
<ol>
<li><span style="color:#444C99;">Downloadすると, <code>Download</code>フォルダに入る。<code>Application</code>フォルダに移動（ここまで通常の作業）。</span></li>
<li><span style="color:#444C99;"><code>Application</code>フォルダ内のアイコンを直接ダブルクリックしても、起動できない。“ImageJ.app” cannot be opened because the developer cannot be verified. macOS cannot verify that this app is free from malware. というメッセージが出て、<code>Cancel</code>を押すしかない。そこで、、、</span></li>
<li><span style="color:#444C99;">ImageJをDockにいれる。<code>Application</code>フォルダ内のアイコンをドラッグして、Dockにドロップする。</span></li>
<li><span style="color:#444C99;">Dock内のImageJアイコン上で、<code>right click</code> &gt; <code>Open</code></span></li>
<li><span style="color:#444C99;">先とは異なるメッセージ macOS cannot verify the developer of “ImageJ.app”. Are you sure you want to open it? が出て、今度は<code>Open</code>ボタンがあります。</span></li>
<li><span style="color:#444C99;"><code>Open</code>ボタンで一度起動させると、以降はメッセージなく、起動させられます。</span></li>
</ol>
<h3 id="2-use-old-fiji">2. Use old FIJI</h3>
<p>Previous version of FIJI is available at below link.
<a href="https://downloads.imagej.net/fiji/archive/">https://downloads.imagej.net/fiji/archive/</a></p>
<ul>
<li>FIJI 20200721-1931 can open Log file. Use previous version than this.</li>
<li>FIJI 20200802-0255 or newer cannot open Log file.</li>
<li>FIJI 20220414-1745 fiji-macosx.zip cannot. (2022.6.3).</li>
</ul>
<p><span style="color:#444C99;">下記リンク、過去のバージョンリスト(2019.10.27-2020.8.10)には20種のバージョンがあます。</span>
<a href="https://downloads.imagej.net/fiji/archive/">https://downloads.imagej.net/fiji/archive/</a></p>
<ul>
<li><span style="color:#444C99;">FIJI 20200721-1931 Logファイルは正常に開く。これより前の古いバージョンを使ってください。</span></li>
<li><span style="color:#444C99;">FIJI 20200802-0255 Logファイルは直接使えない。もし、これより新しいバージョンを使わなければ行けない場合は、上記の対策1を行ってください。</span></li>
<li><span style="color:#444C99;">FIJI 20220414-1745 fiji-macosx.zipやっぱりダメ。（2022.6.3検証)</span></li>
</ul>
<h3 id="3-copy-and-paste">3. Copy and paste</h3>
<ol>
<li>Open a log file with text editor. For mac, <code>Right click</code>&gt; <code>Open with...</code>&gt; <code>TextEdit.app</code>. For windows, use memopad. Select all and copy.</li>
<li>In ImageJ/FIJI, create new text window. For Linux, Win, Mac, <code>File</code>&gt; <code>New</code>&gt; <code>System clipboard</code>, then automatically paste values. For Mac, <code>Plug-ins</code>&gt;<code>New</code>&gt;<code>Text Window...</code> (any width, any height). Paste manually.</li>
<li>Now, log file is available in FIJI/ImageJ. </li>
<li>Open serial images in ImageJ/FIJI</li>
<li>Apply "Image Stabilizer Log Applier"
    In case of error "Invarid log: For input string: 0", delete "space" next to 0 in the 2nd line. There may be "space" in the 1st and 3rd lines, but no need to be deleted.</li>
</ol>
<h3 id="_5"></h3>
<ol>
<li><span style="color:#444C99;">Logファイルをテキストとして開く。Macの場合、Finderで保存したLogファイル上で右クリック、アプリ指定で開く Open with... TextEdit.app。Windowsの場合、メモ帳で開く。すべて選択してコピー。</span></li>
<li><span style="color:#444C99;">ImageJ/FIJIで、新規のテキストウィンドウを作る。Linux, Win, Macの場合、<code>File</code>&gt; <code>New</code>&gt; <code>System clipboard</code>　上記でコピーしておいたデータがすでにペーストされています。Macの場合、<code>Plug-ins</code>&gt;<code>New</code>&gt;<code>Text Window...</code> (width, heightはなんでもよい) でもできます、手動でペーストします。（以前、Plug-ins由来のこの方法は、Mac, Winでできると記していましたが、Macだけの対応でした。すみません訂正します。2021.4）</span></li>
<li><span style="color:#444C99;">これでLogファイルが正常に開いた状態になります。以降は通常のImage Stabilizer Log Applierの手順です。</span></li>
<li><span style="color:#444C99;">ImageJ/FIJIで、連続画像を開く</span></li>
<li><span style="color:#444C99;">ImageJ/FIJI　Plug-ins &gt; Image Stabilizer Log Applier</span>
    <span style="color:#444C99;">エラー 「Invarid log: For input string: "0 "」が出る場合、2行目の「0」のとなりにスペースが入ってしまっているかも知れません。2行目のスペースを削除してください。なお、1行目および3行目以降にも、末尾スペースがありますが、削除する必要はありません。</span></li>
</ol>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © 2021 Yuki Tajika, CC BY 4.0
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>